<!DOCTYPE html>
<html>
	<head>
		<title>Gallery Explorer</title>
		<link rel="icon" href="/favicon.ico" type="image/x-icon" />
		<link href="/static/viewer.css" rel="stylesheet" type="text/css">
		<style type="text/css">
			html
			{
				color: #111;
				height: 100%;
				font: 15px/20px "Lucida Grande", sans-serif, Arial;
			}

			body
			{
				margin: 0;
			}

			#navigator
			{
				position: fixed;
				top: 0;
				width: 100%;
				font-size: 24px;
				padding: 1em 2em;
				z-index: 1000;
				background-color: #eee;
			}

			#navigator a
			{
				font-weight: bold;
			}

			#viewer
			{
				position: relative;
				margin-top: 4em;
			}
		</style>
		<script src="/static/jquery.min.js" type="text/javascript"></script>
		<script src="/static/viewer.js" type="text/javascript"></script>
		<script type="text/javascript">
			var viewer;

			var updateNavigator = function () {
				$("#navigator").empty();

				var dirs = location.hash.substr(1).split("/");

				var link = "#";
				for (var i in dirs) {
					var dirname = dirs[i];
					if (dirname) {
						link += dirname + "/";
						$("#navigator").append("<a href='" + link + "'>" + dirname + "</a>");
						$("#navigator").append("<span> / <span>");
					}
				}
			};

			var refreshViewer = function () {
				var root = location.hash.match(/#(.*)/)[1];

				$.get("dir?root=" + encodeURIComponent(root), function (data) {
					//console.log("dir result:",  data);
					data = JSON.parse(data);

					viewer.update(root, data);
				});
			};

			var onHashChanged = function () {
				var hash = location.hash;
				if (hash == "")
					location.hash = "./";
				else if (!/.*\/$/.test(hash))
					location.hash = location.hash + "/";
				else {
					refreshViewer();
					updateNavigator();
				}
			};

			$(function () {
				viewer = new GE.Viewer($("#viewer"));

				window.onhashchange = onHashChanged;

				$(window).resize(function () { viewer.updateLayout(); });

				onHashChanged();
			});
		</script>
	</head>
	<body>
		<div id="navigator"></div>
		<div id="viewer"></div>
	</body>
</html>
