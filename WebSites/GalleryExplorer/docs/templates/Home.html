<!DOCTYPE html>
<html>
	<head>
		<title>Gallery Explorer</title>
		<link rel="icon" href="/favicon.ico" type="image/x-icon" />
		<link href="/static/viewer.css" rel="stylesheet" type="text/css">
		<style type="text/css">
			html
			{
				color: #111;
				height: 100%;
				font: 15px/20px "Lucida Grande", sans-serif, Arial;
			}
		</style>
		<script src="/static/jquery.min.js" type="text/javascript"></script>
		<script src="/static/viewer.js" type="text/javascript"></script>
		<script type="text/javascript">
			var viewer;

			var refreshViewer = function () {
				var root = location.hash.match(/#(.*)/)[1];

				$.get("dir?root=" + encodeURIComponent(root), function (data) {
					//console.log("dir result:",  data);
					data = JSON.parse(data);

					viewer.update(root, data);
				});
			};

			var onHashChanged = function () {
				var hash = location.hash;
				if (hash == "")
					location.hash = "./";
				else if (!/.*\/$/.test(hash))
					location.hash = location.hash + "/";
				else
					refreshViewer();
			};

			$(function () {
				viewer = new GE.Viewer($("#viewer"));

				window.onhashchange = onHashChanged;

				$(window).resize(function () { viewer.updateLayout(); });

				onHashChanged();
			});
		</script>
	</head>
	<body>
		<div id="viewer"></div>
	</body>
</html>
