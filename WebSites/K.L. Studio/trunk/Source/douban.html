<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title>
豆瓣

</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="Expires" content="Sun, 6 Mar 2005 01:00:00 GMT" />
    
<meta content="提供图书、电影、音乐唱片的推荐、评论和价格比较，以及城市独特的文化生活。" name="description"/>

    <script type="text/javascript" src="http://t.douban.com/js/packed_jquery0.js"></script>
    <link rel="shortcut icon" href="http://t.douban.com/favicon.ico" type="image/x-icon" />
    <link href="http://img2.douban.com/css/packed_douban226.css" rel="stylesheet" type="text/css" />
    <link href="http://img2.douban.com/css/separation/packed__all63.css" rel="stylesheet" type="text/css" />
    <script type="text/javascript" src="http://img2.douban.com/js/packed_douban84.js"></script>
    <script type="text/javascript" src="http://img2.douban.com/js/separation/packed__all8.js"></script>
    

    <style type="text/css">


</style>
    <script type="text/javascript">

$(function(){
	var max = 128, 
	isvalid = false,
	node_root = '#db-talk',
	node_textarea = '#db-talk textarea',
	node_form = '#db-talk form',
	node_rec = '#db-talk .msg a',
	node_msg = '#db-talk .tipmsg',
	node_dlg = '#dialog',
	node_cta = '#db-talk .bn-cta',
	css_rec_dlg = 'rec-dlg',
	css_error = 'talk-error',
	css_frm_error = 'errmsg',
	css_bn_hover = 'bn-cta-over',
	err_title = '请填写标题',
	err_url = '请填写正确的网址',
	
	update = function(n){
		var msg = $(node_msg);
		if (n < 0) {
			isvalid = false;
		} else if(n < max) {
			isvalid = true;
		} else {
			isvalid = false;
		}
		
		if (!isvalid) {
			if (!msg[0]) {
				msg = $(node_cta).after('<span class="tipmsg"></span>');
			}
			
			if (n < 0){
			  msg.addClass('error').html('多了<b>' + (-1*n) + '</b>个字');
			} else if (n === max) {
				msg.html('');
			}
		} else if (n < 11) {
	      msg.removeClass('error').html('还能写<b>' + (n) + '</b>个字');	
		} else {
			msg.html('');
		}
		
		
	},
	
	check = function(e){
		update(max - $.trim(e?e.target.value : $(node_textarea)[0].value).length);
	},
	
	getUrl = function(){
		var url = $(node_textarea)[0].value.match(/(http\:\/\/[0-9a-z\-\.\/]+)/i)
		return url && url[1];
	},
	
	displayErrMsg = function(node, err, is){
		var errmsg = $(node).parent().find('.errmsg');
		if (is) {
		  if(errmsg[0]){
		    errmsg.css('visibility', 'visible').html(err);	
		  } else {
		    $(node).after('<span class="errmsg">' + err + '</span>');	
		  }
		} else {
	      if(errmsg[0]){
		   errmsg.css('visibility', 'hidden');
		  }	
		}
	};
	
	check();
	
	$(node_textarea).keyup(check);
	
	$(node_form).submit(function(e){
		check();
		if(!isvalid){
		  if ($.trim($(node_textarea)[0].value) === '') {
		  $(node_msg).html('写几个字先');
		  }
			e.preventDefault();
		}
	});
	
	$(node_rec).click(function(e){
		e.preventDefault();
		var url = getUrl();
		show_dialog($('#' + e.target.href.split('#')[1]).html());
		
		$(node_dlg + ' form').submit(function(e){
			e.preventDefault();
			var isvalid = true, 
			frm = e.target,
			errmsg,
			url = frm.elements['uid'],
			title = frm.elements['title'];
			
			if($.trim(url.value) === '' ||
	!/([a-zA-Z]+\:\/\/)?(.+\.)?(\w+)(\.\w+)(:[0-9]+)?(\/.+)?/.test($.trim(url.value))){
			  isvalid = false;
			  displayErrMsg(url, err_url, 1);
			} else {
			  displayErrMsg(url, '', 0);
			}
			if ($.trim(title.value) === ''){
				isvalid = false;
				displayErrMsg(title, err_title, 1);
			}else {
				displayErrMsg(title, '', 0);
			}
			if(isvalid){
				$("#ban_word").remove();
		        remote_submit_json(frm, function(data){
		            if(data.ban){
                      $(':submit,:input',form).attr('disabled',false);
                      $(".recsubmit").before('<div class="attn" id="ban_word">你的推荐中有被禁止的内容</div >');
                     set_overlay();
		             return;
		            }
		            document.location.reload();
		        });
			}
		});
		
		if (url) {
		  $(node_dlg + ' form input[name=uid]')[0].value = url;	
		}
	});
	
	$(node_cta).mouseover(function(e){
		$(e.target).addClass(css_bn_hover);
	}).mouseout(function(e){
		$(e.target).removeClass(css_bn_hover);
	});
});


// Creating custom :external selector        
$.expr[':'].external = function(obj){        
    return (obj.href!='javascript:void(0)') && (obj.hostname != location.hostname);          
}; 
var add_target = function(){
    $("#miniblog a:external").attr("target", "_blank");
};

$(function(){

    $('#filter-type').renderDropList({
        width: '90px',
        callback: function(text, value, node) {
            var i = value.split('-');
            location.href=location.href.split('?')[0]+'?utype='+i[0]+'&type='+i[1];
        }
    });

    add_target();
});

</script>
</head>
<body>
<div id="wrapper">
  <div id="content">
    <div class="grid-16-8 clearfix">
      <div class="aside">
        
        
        
        
        
        
  <div id="db-talk" class="mod">
    <form name="mbform" method="post" action=""><div style="display:none;"><input type="hidden" name="ck" value="nQ0j"/></div>
    <div class="item">
        <textarea name="mb_text" rows="1"></textarea>
    </div>
    <span class="msg">
        <a tabindex="2" href="#db-dlg-reclink">推荐网址</a>
    </span>
    <div class="btn">
        <input class="bn-cta" type="submit" value="我说">
    </div>
    </form>
</div>

<div class="hidden" id="db-dlg-reclink">
<div class="rec-dlg">
<form method="post" action="/j/recommend" class="j a_rec_form"><div style="display:none;"><input type="hidden" name="ck" value="nQ0j"/></div>
<div class="rectitle">
<span class="gact rr"><a href="javascript:void(0)"onclick="close_dialog()">x</a></span>
<span class="m">向我的友邻推荐网址 <em>(更多推荐方式)</em></span>
</div>
<input type="hidden" name="type" value="I"/>
<div class="item">
  <label>网址:</label>
  <input type="text" name="uid"/>
</div>
<div class="item">
  <label>标题(必填):</label>
  <input type="text" name="title"/>
</div>
<div class="item">
  <label>推荐语:</label>
  <textarea class="text" name="comment" rows="3"></textarea>
</div>
<div class="recsubmit">
  <input value="确定" type="submit"/>
  <input value="取消" onclick="close_dialog();" type="button"/>
</div>
</form>
</div>
</div>
  </div>
        <div class="extra">
            
        </div>
    </div>
    </div>
    </div>
    
    
    
<script type="text/javascript">
var _gaq = _gaq || [];
_gaq.push(['_setAccount', 'UA-7019765-1']);
_gaq.push(['_addOrganic', 'baidu', 'word']);
_gaq.push(['_addOrganic', 'soso', 'w']);
_gaq.push(['_addOrganic', '3721', 'name']);
_gaq.push(['_addOrganic', 'yodao', 'q']);
_gaq.push(['_addOrganic', 'vnet', 'kw']);
_gaq.push(['_addOrganic', 'sogou', 'query']);
_gaq.push(['_addIgnoredOrganic', '豆瓣']);
_gaq.push(['_addIgnoredOrganic', 'douban']);
_gaq.push(['_addIgnoredOrganic', '豆瓣网']);
_gaq.push(['_addIgnoredOrganic', 'www.douban.com']);
_gaq.push(['_setDomainName', '.douban.com']);
_gaq.push(['_trackPageview']);
_gaq.push(['_setVar', '4143']);


(function() {
    var ga = document.createElement('script');
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    ga.setAttribute('async', 'true');
    document.documentElement.firstChild.appendChild(ga);
})();
</script>



    <!-- bifur-->
</body>
</html>
