import{l as R}from"./tf-data.esm-IE7cwnvQ.js";import H from"./cube3-player-BMBR7HRu.js";import{E as m,b,T as _,q as E,i as y,s as w,c as B,d as O}from"./cubeObject-CTeWqh_v.js";import{_ as j,r as N,c as L,o as $,b as k,a as v}from"./router-JVv0ElFj.js";import"./url-DHKDaZKd.js";import"./_commonjsHelpers-DM6icglO.js";import"./vue-resize-directive-CDf_Yp3t.js";import"./cube3-BnueevaP.js";import"./three.module-x1Cfo4R0.js";import"./delay-DTFr9Qec.js";import"./roll-quaternion-BKmTCWc9.js";import"./cube-algebra-Cwll5vw1.js";const C=e=>{let t=1;for(let o=e.clone();!o.isZero();o=o.multiply(e))++t;return t},f=(e,t)=>{if(t<=0||e<=0)return[];if(e<t)return f(e,e);if(e===t)return[...f(e,e-1),[e]];const o=f(e,t-1),n=f(e-t,t);return[...o,...n.map(r=>[...r,t])]},g=e=>f(e,e).reverse().map(t=>t.reverse().map(o=>String.fromCharCode(o)).join("")).reduce((t,o,n)=>(t[o]=n,t),{}),Z=g(6),q=g(8),M=g(12),h=e=>e.reduce((t,o)=>(++t[o],t),Array(24).fill(0)).filter(t=>t>0).sort((t,o)=>o-t).map(t=>String.fromCharCode(t)).join(""),U=e=>({corners:h(m.slice(0,8).map(t=>e.units[t])),edges:h(m.slice(8,20).map(t=>e.units[t])),axes:h(m.slice(20,26).map(t=>e.units[t]))}),p=e=>{const t=U(e),o=[Z[t.axes],q[t.corners],M[t.edges]];return console.assert(o[0]>=0,"invalid axes:",t.axes),console.assert(o[1]>=0,"invalid corners:",t.corners),console.assert(o[2]>=0,"invalid edges:",t.edges),o[0]+(o[1]<<4)+(o[2]<<9)},P=(e,{units:t=26}={})=>m.slice(0,t).map(o=>e.units[o]).reduce((o,n)=>(++o[n],o),Array(24).fill(0)).filter(o=>o>0).length,c=[],u={},Y=e=>{const t=Array(12).fill(null).map((n,r)=>p(e.clone().twist(r)));return _.map(n=>B(n,t).map(r=>String.fromCharCode(r)).join("")).reduce((n,r,s)=>!n||r<n.code?{index:s,code:r}:n,null)},I=e=>{const t=C(e),o=p(e),n=Y(e);return{hash:String.fromCharCode(t)+String.fromCharCode(o)+n.code,index:n.index}},z=e=>e.split("").map(t=>t.charCodeAt(0).toString()).join(","),x=e=>e.split(",").map(Number).map(t=>String.fromCharCode(t)).join(""),T=async(e,t)=>{if(c[e]){console.warn("hash depth load duplicated:",e);return}c[e]=[];for await(const o of t){if(!o)continue;const[n,r,s,i]=o.split("	"),a=x(n),l={depth:e,hash:a,state:s,twist:parseInt(r,18),parentIndex:parseInt(i)};c[e].push(l),console.assert(!u[a],"duplicated hash:",a,u[a],l),u[a]=l}},d=(e,t=0)=>{if(t>26)return null;if(e.isZero())return[];const{hash:o,index:n}=I(e);if(!u[o])return null;const r=_[n][u[o].twist];return[r,...d(e.clone().twist(r),t+1)||[]]},D=e=>{for(const t of c)if(t)for(const{state:o}of t){const n=new b({code:o}),r=e.divide(n),s=d(r);if(s)return[...s,...d(n)]}return null},V=e=>{const t=d(e);if(t)return t;const o=Array(48).fill(null).map((r,s)=>e.clone().transform(s)).reduce((r,s,i)=>(r[s.encode()]={cube:s,transform:i},r),{}),n=Object.values(o);for(const r of n){const s=D(r.cube);if(s)return s.map(i=>_[r.transform].indexOf(i))}return null},F=e=>d(new b({code:e})),S=e=>d(new b({path:e})),A=e=>{const t=S(e);if(t)return y(t);for(let o=e.length-1;o>=c.length;--o){const n=e.length-o,r=Array(n).fill(null).map((s,i)=>{const a=e.slice(i,o+i),l=S(a);return l?(l.length>=c.length&&console.warn("invalid solution:",w(a),"->",w(l)),l.length>=a.length?null:[].concat(...e.slice(0,i),y(l),...e.slice(i+o))):null}).filter(s=>s);if(r.length)return r.map(i=>A(i)||i).reduce((i,a)=>a.length<i.length?a:i)}return null},Q=e=>A(E(e)),W=Object.freeze(Object.defineProperty({__proto__:null,hashCube:I,hashIndices:u,hashLibrary:c,loadHashes:T,parseHash:x,printHash:z,simplifyPath:Q,solveCubeBinary:V,solveState:F},Symbol.toStringTag,{value:"Module"}));var G={};window.cube3=O;window.cubeLoop=C;window.cubePartitionComplexity=P;window.cube3Hash=W;window.cubePartitionCode=p;const J={name:"cube3-solver",components:{Cube3Player:H},created(){window.$main=this,this.loadHashes()},mounted(){},methods:{async loadModel(){this.model=await R("/mlmodels/cube3/length/model.json")},async loadHashes(){const e=G.CUBE3_HASH_LIBRARY_SIZE;if(!e){console.warn("CUBE3_HASH_LIBRARY_SIZE is zero, loading skipped.");return}if(!(c.length>e))for(let t=1;t<=e;++t){const n=await(await fetch(`/data/cube3-hash-${t}.txt`)).text();await T(t,{*[Symbol.iterator](){yield*n.split(`
`)}})}},solve(){const e=this.$refs.player.$refs.viewer.cube.algebra;console.log("cube:",C(e),P(e),p(e))}}},K={id:"panel"};function X(e,t,o,n,r,s){const i=N("Cube3Player");return $(),L("body",null,[k(i,{ref:"player"},null,512),v("div",K,[v("button",{onClick:t[0]||(t[0]=(...a)=>s.solve&&s.solve(...a))},"Solve")])])}const fe=j(J,[["render",X]]);export{fe as default};
