import{V as h,ah as C,c as b,ae as R,a as f,E as y,af as S,X as _,ai as z}from"./three.module-x1Cfo4R0.js";import{a as P}from"./delay-DTFr9Qec.js";import{C as m}from"./cubeObject-CTeWqh_v.js";import{C as v}from"./latin-letters-Cf9SrFGT.js";import{L as A}from"./label3D-Z-TrrnsP.js";import{G as O,O as E}from"./greek-letters-D2RlIem_.js";import{_ as L,c as d,o as u,a as c,r as I,w as p,p as g,e as k,j as w,F as D,g as B,v as M,n as G,h as N}from"./router-JVv0ElFj.js";const X={name:"loading-dots"},U={class:"loading-dots"};function Y(e,t,s,i,o,a){return u(),d("div",U,[...t[0]||(t[0]=[c("div",{class:"ellipsis"},[c("div"),c("div"),c("div"),c("div")],-1)])])}const j=L(X,[["render",Y],["__scopeId","data-v-7bded815"]]),W=e=>{const t=[Math.abs(e.x),Math.abs(e.y),Math.abs(e.z)],s=Math.max(...t);return t[0]===s?e.x>0?1:0:t[1]===s?e.y>0?3:2:e.z>0?5:4},$=[new h(-1.5,0,0),new h(1.5,0,0),new h(0,-1.5,0),new h(0,1.5,0),new h(0,0,-1.5),new h(0,0,1.5)],H=[...Array(6).fill("white"),"black"].map(e=>new b({color:new f(e)})),T=["#fd6","#faa","#efb","#fff","#aaf","#8f8","black"].map(e=>new b({color:new f(e)})),V=["#fea","#fcc","#ff8","#ddd","#ddf","#cfc","#222"].map(e=>new b({color:new f(e)})),x=700,F={name:"labeled-cube3",components:{Loading:j},props:{size:{type:Object,default:()=>({width:800,height:800})},code:String,enabledTwist:{type:Boolean,default:!0},showRedLabels:Boolean,coloredUnderbox:Boolean,showOrientations:Boolean},data(){return{labels:[],loading:!1,highlightCubie:null}},async mounted(){this.rendererActive=!0,this.loading=!0,this.initializeRenderer(),this.cubeGroup=new _,this.scene.add(this.cubeGroup),this.cube=new m({materials:this.coloredUnderbox?T:H,onChange:t=>this.onChange(t),meshSchema:"cube",twistDuration:x}),this.cubeGroup.add(this.cube.graph),this.code&&this.cube.setState(this.code),this.labels=this.cube.graph.children.map(t=>{const s=t.children[0],i=new A(s,this.camera,{offset:[0,0,0]}),o=i.graphNode.parent.position;return i.graphNode.position.set(o.x*.5,o.y*.5,o.z*.5),i}),this.$emit("cubeCreated",this.cube);const e=await this.createLabelMaterials();if(this.cubeLB=new m({materials:e,meshSchema:"cube26"}),this.cubeLB.graph.scale.set(1.01,1.01,1.01),this.cubeGroup.add(this.cubeLB.graph),this.showRedLabels){const t=await this.createLabelMaterials("red");this.cubeLR=new m({materials:t,meshSchema:"cube26",twistDuration:x}),this.cubeLR.graph.scale.set(1.005,1.005,1.005),this.cubeGroup.add(this.cubeLR.graph),this.code&&this.cubeLR.setState(this.code)}this.raycaster=new z,this.holdingAxis=null,this.$emit("sceneInitialized",this),this.render(),this.loading=!1},beforeDestroy(){this.rendererActive=!1},methods:{initializeRenderer(){this.renderer=new R({antialias:!0,canvas:this.$refs.canvas,alpha:!0}),this.renderer.setClearColor(new f("black"),0),this.renderer.setSize(this.size.width,this.size.height,!1),this.camera=new y(60,this.size.width/this.size.height,3,12),this.camera.position.set(0,0,6.4),this.camera.lookAt(0,0,0),this.scene=new S},async createLabelMaterials(e="black"){const t=this.$refs.textureCanvas.getContext("2d"),s=[];for(let i=0;i<26;++i){const o=v[i];switch(t.clearRect(0,0,256,256),e){case"black":t.font="240px monospace",t.fillStyle="black",t.fillText(o,60,200);break;case"red":t.font="160px monospace",t.fillStyle="red",t.fillText(o,160,240);break}const a=await new Promise(l=>this.$refs.textureCanvas.toBlob(l,"image/png")),r=new Image;r.src=URL.createObjectURL(a),await new Promise(l=>r.onload=l);const n=new C(r);n.needsUpdate=!0,s.push(n)}return s.map(i=>new b({map:i,transparent:!0,depthWrite:!1}))},async render(){let e=performance.now(),t=Math.floor(e/1e3),s=0,i=0;for(;this.rendererActive;){this.$emit("beforeRender",this),this.renderer.render(this.scene,this.camera),this.$emit("afterRender",this),this.showOrientations&&this.updateLabels(),++s;const o=performance.now();i=Math.max(i,o-e);const a=Math.floor(o/1e3);if(a>t){const r=s/(a-t);this.$emit("fps",{fps:r,stuck:i}),s=0,i=0,t=a}e=o,await P()}},updateLabels(){const e=this.cube.graph.worldToLocal(this.camera.position.clone());for(let t=0;t<this.labels.length;t++){const s=this.labels[t];s.updatePosition();const i=this.cube.algebra.units[t];s.content=O[E[i]];const o=s.graphNode.parent.position.clone();o.applyQuaternion(s.graphNode.parent.parent.quaternion);const a=Math.round(o.x)*e.x>0&&Math.abs(e.x)>1.5,r=Math.round(o.y)*e.y>0&&Math.abs(e.y)>1.5,n=Math.round(o.z)*e.z>0&&Math.abs(e.z)>1.5;s.visible=a||r||n}},normalizeScreenPoint(e){return new h(e.offsetX/this.$refs.canvas.clientWidth*2-1,1-e.offsetY/this.$refs.canvas.clientHeight*2,0)},raycastAxis(e){if(this.raycaster){const t=this.normalizeScreenPoint(e);this.raycaster.setFromCamera(t,this.camera);const s=this.raycaster.intersectObject(this.cube.graph,!0);if(s[0]){const i=this.cube.graph.worldToLocal(s[0].point);return W(i)}}return null},raycastCubie(){if(this.raycaster){const e=this.normalizeScreenPoint(event);this.raycaster.setFromCamera(e,this.camera);const t=this.raycaster.intersectObject(this.cube.graph,!0);if(t[0]){const s=this.cube.graph.worldToLocal(t[0].point),i=[s.x,s.y,s.z].map(o=>Math.round(o)+1);return i[0]+i[1]*3+i[2]*9}}return null},reset(){this.cube.reset(),this.cubeLR.reset()},twist(e){return Promise.all([this.cube.twist(e),this.cubeLR&&this.cubeLR.twist(e)])},onMouseMove(e){if(this.cube)if(Number.isInteger(this.holdingAxis)&&e.buttons!==4){const s=this.normalizeScreenPoint(e).clone().sub(this.holdPosition.start),o=-this.holdPosition.start.clone().sub(this.holdPosition.pivot).normalize().clone().cross(s).z*3;this.cube.twistGraph(this.holdingAxis,o),this.cubeLR&&this.cubeLR.twistGraph(this.holdingAxis,o)}else switch(e.buttons){case 1:case 4:this.cubeGroup.rotateOnWorldAxis(new h(0,1,0),e.movementX*.01),this.cubeGroup.rotateOnWorldAxis(new h(1,0,0),e.movementY*.01);break;case 0:const t=this.raycastCubie(e);this.highlightCubie=this.cube.algebra.positions.indexOf(t),this.coloredUnderbox&&(this.cube.cubeMeshes.forEach(s=>s.material=T),Number.isInteger(this.highlightCubie)&&this.cube.cubeMeshes[this.highlightCubie]&&(this.cube.cubeMeshes[this.highlightCubie].material=V));break}},onMouseDown(e){switch(e.buttons){case 1:if(this.enabledTwist){const t=this.raycastAxis(e);if(Number.isInteger(t)){const s=this.cube.graph.localToWorld($[t].clone());s.project(this.camera),s.z=0,this.holdingAxis=t,this.holdPosition={pivot:s,start:this.normalizeScreenPoint(e)}}}break}},onMouseUp(){Number.isInteger(this.holdingAxis)&&(this.cube.releaseGraph(),this.cubeLR&&this.cubeLR.releaseGraph(),this.holdingAxis=null)},touchToOffsetPoint(e,t={buttons:0}){const s=this.$el.getBoundingClientRect();return{offsetX:e.pageX-s.x,offsetY:e.pageY-s.y,...t}},onTouchStart(e){this.rendererActive&&e.touches.length===1&&(this.onMouseDown(this.touchToOffsetPoint(e.touches[0],{buttons:1})),e.preventDefault())},onTouchMove(e){switch(e.touches.length){case 1:const t=this.touchToOffsetPoint(e.touches[0]);this.onMouseMove(t),this.lastTouchPoint={offsetX:t.offsetX,offsetY:t.offsetY},e.preventDefault();break;case 2:{const s=this.touchToOffsetPoint(e.touches[0],{buttons:1});this.lastTouchPoint&&(s.movementX=s.offsetX-this.lastTouchPoint.offsetX,s.movementY=s.offsetY-this.lastTouchPoint.offsetY,this.holdingAxis=null,this.onMouseMove(s)),this.lastTouchPoint={offsetX:s.offsetX,offsetY:s.offsetY}}e.preventDefault();break}},onTouchEnd(){this.onMouseUp(),this.lastTouchPoint=null},onChange(e){this.innerCode=e.encode(),this.$emit("update:code",this.innerCode)}},watch:{size(e){this.camera.aspect=e.width/e.height,this.camera.updateProjectionMatrix(),this.renderer.setSize(e.width,e.height,!1)},code(e){e&&this.innerCode!==e&&(this.cube&&this.cube.setState(e),this.cubeLR&&this.cubeLR.setState(e))},highlightCubie(e){this.$emit("update:highlightCubie",e)}}},K={class:"labeled-cube3"},q=["width","height"],Q={ref:"textureCanvas",class:"texture-canvas",width:256,height:256},Z={key:0},J=["innerHTML"];function ee(e,t,s,i,o,a){const r=I("Loading");return u(),d("div",K,[c("canvas",{ref:"canvas",width:s.size.width,height:s.size.height,onMousemove:t[0]||(t[0]=w((...n)=>a.onMouseMove&&a.onMouseMove(...n),["stop"])),onMousedown:t[1]||(t[1]=w((...n)=>a.onMouseDown&&a.onMouseDown(...n),["prevent"])),onMouseup:t[2]||(t[2]=(...n)=>a.onMouseUp&&a.onMouseUp(...n)),onTouchstart:t[3]||(t[3]=(...n)=>a.onTouchStart&&a.onTouchStart(...n)),onTouchmove:t[4]||(t[4]=(...n)=>a.onTouchMove&&a.onTouchMove(...n)),onTouchend:t[5]||(t[5]=(...n)=>a.onTouchEnd&&a.onTouchEnd(...n))},null,40,q),p(c("canvas",Q,null,512),[[M,!1]]),s.showOrientations?(u(),d("div",Z,[(u(!0),d(D,null,B(o.labels,(n,l)=>p((u(),d("span",{class:N(["label",{highlight:l===o.highlightCubie}]),key:l,innerHTML:n.content,style:G({left:`${n.position.x*100}%`,top:`${n.position.y*100}%`})},null,14,J)),[[M,n.visible]])),128))])):g("",!0),o.loading?(u(),k(r,{key:1})):g("",!0)])}const he=L(F,[["render",ee],["__scopeId","data-v-a3756bc8"]]);export{he as L};
