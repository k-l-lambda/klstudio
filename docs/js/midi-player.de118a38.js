(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["midi-player"],{"0fad":function(e,t,i){},"37b2":function(e,t,i){"use strict";var r=i("0fad"),s=i.n(r);s.a},"5b77":function(e,t,i){"use strict";i.r(t);var r=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{directives:[{name:"resize",rawName:"v-resize",value:e.onResize,expression:"onResize"}],staticClass:"midi-player",class:{hover:e.dragHover,empty:!e.player},on:{dragover:function(t){t.preventDefault(),e.dragHover=!0},dragleave:function(t){e.dragHover=!1},drop:function(t){return t.preventDefault(),e.onDrop(t)}}},[i("header",[i("StoreInput",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],attrs:{localKey:"midiPlayer.source"},model:{value:e.source,callback:function(t){e.source=t},expression:"source"}}),i("StoreInput",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],attrs:{localKey:"midiPlayer.name"},model:{value:e.name,callback:function(t){e.name=t},expression:"name"}}),e.name?i("span",{domProps:{textContent:e._s(e.name)}}):e._e(),e.player?i("button",{on:{click:e.togglePlayer}},[e.player?i("i",[e._v(e._s(e.player.isPlaying?"":""))]):e._e()]):e._e(),e.player&&e.player.notation?i("ProgressBar",{attrs:{cursor:e.cursorTime,duration:e.player.notation.endTime},on:{"update:cursor":function(t){e.cursorTime=t}}}):e._e()],1),i("main",[i("MidiRoll",{attrs:{player:e.player,timeScale:e.viewTimeScale,height:400,width:e.windowSize.width}})],1)])},s=[],a=i("428d"),o=i.n(a),n=i("caea"),l=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("span",{staticClass:"progress-bar",on:{mousemove:e.onMouseMove,mouseleave:e.onMouseLeave,click:e.emitCursor}},[i("span",{staticClass:"fill cursor",style:{width:100*e.progress+"%"}}),e.indicator?i("span",{staticClass:"fill indicator",style:{width:100*e.indicator+"%"}}):e._e(),i("span",{staticClass:"timer"},[i("span",{domProps:{innerHTML:e._s(e.formatTime(e.cursor))}}),e._v(" / "),i("span",{domProps:{innerHTML:e._s(e.formatTime(e.duration))}})])])},u=[],d={name:"progress-bar",props:{cursor:Number,duration:{type:Number,validator:e=>e>0}},data(){return{indicator:null}},computed:{progress(){return this.cursor/this.duration}},methods:{onMouseMove(e){this.indicator=e.offsetX/this.$el.clientWidth,1===e.buttons&&this.emitCursor()},onMouseLeave(){this.indicator=null},emitCursor(){const e=this.cursor;this.$emit("update:cursor",this.indicator*this.duration),this.$emit("turnCursor",this.indicator*this.duration,e)},formatTime(e){if(!Number.isFinite(e)||e<0)return"--:--";const t=Math.floor(e/6e4),i=(e%6e4/1e3).toFixed(1).replace(/\.(\d+)$/,"<sub>.$1</sub>");return`${t}:${e%6e4/1e3<10?"0":""}${i}`}}},c=d,p=(i("37b2"),i("0c7c")),h=Object(p["a"])(c,l,u,!1,null,"07d429be",null),m=h.exports,y=i("cdaf");const f=e=>{const t=new Uint8Array(e),i=[...t].map(e=>String.fromCharCode(e)).join("");return btoa(i)},v=e=>{const t=atob(e),i=t.split("").map(e=>e.charCodeAt(0));return new Uint8Array(i).buffer};var g={name:"midi-player",directives:{resize:o.a},components:{MidiRoll:n["MidiRoll"],ProgressBar:m,StoreInput:y["a"]},data(){return{dragHover:!1,player:null,viewTimeScale:.004,name:null,source:null,windowSize:{width:800,height:800}}},computed:{cursorTime:{get(){return this.player&&this.player.progressTime},set(e){this.player&&this.player.turnCursor(e)}}},created(){n["MidiAudio"].WebAudio.empty()&&n["MidiAudio"].loadPlugin({soundfontUrl:"./soundfont/",api:"webaudio"}).then(()=>console.log("Soundfont loaded.")),window.addEventListener("keydown",e=>{let t=!0;const i="INPUT"===document.activeElement.nodeName;switch(e.key){case" ":i||this.togglePlayer();break;default:t=!1}t&&e.preventDefault()})},mounted(){this.source&&this.loadMidiBuffer(v(this.source))},beforeDestroy(){this.player&&this.player.pause()},methods:{onResize(){this.windowSize={width:this.$el.clientWidth,height:this.$el.clientHeight}},async loadMidiFile(e){const t=await new Promise(t=>{const i=new FileReader;i.onload=()=>t(i.result),i.readAsArrayBuffer(e)});this.name=e.name,this.loadMidiBuffer(t)},async loadMidiBuffer(e){this.player&&(this.player.dispose(),this.player=null),this.source=f(e);const t=n["MIDI"].parseMidiData(e);console.log("midi:",t),this.player=new n["MidiPlayer"](t,{onMidi:(e,t)=>this.onMidi(e,t)})},onDrop(){this.dragHover=!1;const e=event.dataTransfer.files[0];e&&["audio/midi","audio/mid"].includes(e.type)&&this.loadMidiFile(e)},onMidi(e,t){if(!n["MidiAudio"].WebAudio.empty())switch(e.subtype){case"noteOn":n["MidiAudio"].noteOn(e.channel,e.noteNumber,e.velocity,t);break;case"noteOff":n["MidiAudio"].noteOff(e.channel,e.noteNumber,t);break}},togglePlayer(){this.player&&(this.player.isPlaying?this.player.pause():this.player.play())}}},w=g,b=(i("8b27"),Object(p["a"])(w,r,s,!1,null,"e34135c6",null));t["default"]=b.exports},"8b27":function(e,t,i){"use strict";var r=i("a9d4"),s=i.n(r);s.a},a9d4:function(e,t,i){},cdaf:function(e,t,i){"use strict";var r=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("input",{directives:[{name:"model",rawName:"v-model.lazy",value:e.innerValue,expression:"innerValue",modifiers:{lazy:!0}}],style:e.styleObj,attrs:{type:e.type,placeholder:e.placeholder,min:e.range&&e.range.min,max:e.range&&e.range.max,step:e.range&&e.range.step},domProps:{value:e.innerValue},on:{change:function(t){e.innerValue=t.target.value}}})},s=[],a={name:"store-input",props:{type:{type:String,default:"text"},value:{validator(){return!0}},range:Object,styleObj:Object,placeholder:String,localKey:String,sessionKey:String},computed:{innerValue:{get(){return this.value},set(e){this.$emit("input",e)}}},created(){this.load()},methods:{load(){this.localKey&&localStorage[`storeInput-${this.localKey}`]&&(this.innerValue=JSON.parse(localStorage[`storeInput-${this.localKey}`])),this.sessionKey&&sessionStorage[`storeInput-${this.sessionKey}`]&&(this.innerValue=JSON.parse(sessionStorage[`storeInput-${this.sessionKey}`]))},save(){this.localKey&&(localStorage[`storeInput-${this.localKey}`]=JSON.stringify(this.value)),this.sessionKey&&(sessionStorage[`storeInput-${this.sessionKey}`]=JSON.stringify(this.value))}},watch:{value:"save"}},o=a,n=i("0c7c"),l=Object(n["a"])(o,r,s,!1,null,null,null);t["a"]=l.exports}}]);
//# sourceMappingURL=midi-player.de118a38.js.map