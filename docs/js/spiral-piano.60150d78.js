(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["spiral-piano","chunk-2d0abf9e"],{"02f6":function(t,e,n){"use strict";var i=n("92ff"),r=n.n(i);r.a},1823:function(t,e){t.exports="data:image/gif;base64,R0lGODlhrQBaAKIAAAQEBDQ0NOXl5X9/f+bm5oSEhHBwcAAAACH/C05FVFNDQVBFMi4wAwEAAAAh+QQFCgAHACwAAAAArQBaAAAD+Xi63P4wykmrvTjrzbv/YCiOZGmeaKqubOu+cCzPdG3feK7vfO//wKBwSCwaj8ikcslsOp/QqHRKrVqv2Kx2y+16v+CweEwum8/otHrNbrvf8Lh8Tq/b7/i8fs/vSwkCgQQQgIKEgoMPhYGHhnqIjgyQjA2TAg6WmJN5i5CSlokKnYifmQujkXWgl6egpZutpqKud6uvnrGws7IHtrW0u7q9wMO8vnaolMG4y6S5zMXCqtLRqc2st8rP2r/Wz43c34rOfuXm5+jp6uvs7e7v8PHy8/T19vf4+fr7/P3+/wADChxIsKDBgwgTKlzIsKHDhxAjSpxIsWKIBAAh+QQJCgAHACw2ACcACwALAAADGnh60LuhyQClpczarLv/GtcpUYcd5fQo0pMAACH5BAkKAAcALDcAJwAXAAsAAAM4eLrcB7CZMmoxLsAdVP0ftmgbd1CgxZTskYILK79fLJd0Zd8QmhYrnivHILE6h8mHkjk6no0NIwEAIfkECQoABwAsNwAnACQACwAAA1J4utz+B0hHhCXPlMGLcYEkBstlNlyafksojkdlXsymdsyrxzO93KqFbtjzKYAp4fBVtDCQHOVSIuvVkIXcVFFEQRkuHYl7cmhSG5AYwm5rAYwEACH5BAkKAAcALDcAJwAxAAsAAANmeLrc/tCB6Yi4BFr8TBlgYTjBZAYLplbq1YAwPC6leR5bm6W6u3yxEMNGxPUEjCNyEYwtiFBl8showp5Qm5TXq1oH2Owk15p2f9bCUKw4m1deK6NGRLXhLI7DA/uQ6hGBgoMKJgwJACH5BAkKAAcALDcAJwA+AAsAAAN6eLrc/jBKQB0RmMCbd9aOUQxkYTgBpQbL1zUuZsUNadvnkqrrwdGtmCwoZIxuJQZv6RMKGM4nEahA3hbLbBTq5BYXVhs2y9tOXV7qIUwakyk/9PmTliuOyILyrfjWh39SYGwMO0ssfXQPcR4vDSI2IyiHEpWWl5UqDAkAIfkECQoABwAsNwAoAD0ACQAAA2B4R9KkEDIX42xVupdNGWBhKBtVldiJZqhQgTBsXKXVcuRtt9EXhzeXhjdcFWuQXyy4M+aIT+dBCWMeN01kVDulDmjYq2kbJo8Pvl9hITWz2mxul7rN1O00ezxV8cA+BwkAIfkEBQoABwAsNwAoAD0ACQAAA0x4R9KkEDIX42xVupfX1puQhVhFiiY5qldonZzSfqBaw7YMvyefe7jejaYTFn/B3ZCyLB1dzaAP+iQCkTvjckXdpqitzjX2dZbJU0UCADs="},2036:function(t,e,n){"use strict";var i=n("d084"),r=n.n(i);r.a},"2f3d":function(t,e,n){const{Notation:i}=n("af1b"),r=t=>new Promise(e=>setTimeout(e,t));class s{constructor(t,{cacheSpan:e=600,onMidi:n,onPlayFinish:r}={}){this.cacheSpan=e,this.onMidi=n,this.onPlayFinish=r;const s=i.parseMidi(t);this.notations=s,this.events=s.events,this.isPlaying=!1,this.progressTime=0,this.startTime=performance.now(),this.duration=s.endTime,this.cursorTurnDelta=0}dispose(){this.isPlaying=!1,this.progressTime=0}async play(){this.progressTime>=this.duration&&(this.progressTime=0);let t=performance.now();this.startTime=t-this.progressTime,this.isPlaying=!0;let e=this.events.findIndex(e=>e.time>=t-this.startTime);while(this.isPlaying){for(;e<this.events.length;++e){const n=this.events[e];if(!n||n.time>this.progressTime+this.cacheSpan)break;"channel"===n.data.type&&this.startTime+n.time>=t&&this.onMidi&&this.onMidi(n.data,this.startTime+n.time)}if(await r(.1*this.cacheSpan),0!==this.cursorTurnDelta){const n=this.cursorTurnDelta<0;if(this.startTime-=this.cursorTurnDelta,this.cursorTurnDelta=0,n)for(;e>0;--e){const n=this.events[e].time;if(this.startTime+n<t)break}}t=performance.now(),this.progressTime=t-this.startTime,this.progressTime>this.duration&&(this.isPlaying=!1,this.onPlayFinish&&this.onPlayFinish())}}pause(){this.isPlaying=!1}turnCursor(t){this.isPlaying?this.cursorTurnDelta+=t-this.progressTime:this.progressTime=t}}t.exports=s},4003:function(t,e,n){"use strict";var i=n("9779"),r=n.n(i);r.a},"4e44":function(t,e,n){(function(e){const i=n("50be");t.exports=function(t){function n(t){const e=t.read(4),n=t.readInt32();return{id:e,length:n,data:t.read(n)}}let r;function s(t){const e={};e.deltaTime=t.readVarInt();let n=t.readInt8();if(240===(240&n)){if(255!==n){if(240===n){e.type="sysEx";const n=t.readVarInt();return e.data=t.read(n),e}if(247===n){e.type="dividedSysEx";const n=t.readVarInt();return e.data=t.read(n),e}throw new Error("Unrecognised MIDI event type byte: "+n)}{e.type="meta";const n=t.readInt8(),i=t.readVarInt();switch(n){case 0:if(e.subtype="sequenceNumber",2!==i)throw new Error("Expected length for sequenceNumber event is 2, got "+i);return e.number=t.readInt16(),e;case 1:return e.subtype="text",e.text=t.read(i),e;case 2:return e.subtype="copyrightNotice",e.text=t.read(i),e;case 3:return e.subtype="trackName",e.text=t.read(i),e;case 4:return e.subtype="instrumentName",e.text=t.read(i),e;case 5:return e.subtype="lyrics",e.text=t.read(i),e;case 6:return e.subtype="marker",e.text=t.read(i),e;case 7:return e.subtype="cuePoint",e.text=t.read(i),e;case 32:if(e.subtype="midiChannelPrefix",1!==i)throw new Error("Expected length for midiChannelPrefix event is 1, got "+i);return e.channel=t.readInt8(),e;case 47:if(e.subtype="endOfTrack",0!==i)throw new Error("Expected length for endOfTrack event is 0, got "+i);return e;case 81:if(e.subtype="setTempo",3!==i)throw new Error("Expected length for setTempo event is 3, got "+i);return e.microsecondsPerBeat=(t.readInt8()<<16)+(t.readInt8()<<8)+t.readInt8(),e;case 84:if(e.subtype="smpteOffset",5!==i)throw new Error("Expected length for smpteOffset event is 5, got "+i);const n=t.readInt8();return e.frameRate={0:24,32:25,64:29,96:30}[96&n],e.hour=31&n,e.min=t.readInt8(),e.sec=t.readInt8(),e.frame=t.readInt8(),e.subframe=t.readInt8(),e;case 88:if(e.subtype="timeSignature",4!==i)throw new Error("Expected length for timeSignature event is 4, got "+i);return e.numerator=t.readInt8(),e.denominator=Math.pow(2,t.readInt8()),e.metronome=t.readInt8(),e.thirtyseconds=t.readInt8(),e;case 89:if(e.subtype="keySignature",2!==i)throw new Error("Expected length for keySignature event is 2, got "+i);return e.key=t.readInt8(!0),e.scale=t.readInt8(),e;case 127:return e.subtype="sequencerSpecific",e.data=t.read(i),e;default:return e.subtype="unknown",e.data=t.read(i),e}}}else{let i;0===(128&n)?(i=n,n=r):(i=t.readInt8(),r=n);const s=n>>4;switch(e.channel=15&n,e.type="channel",s){case 8:return e.subtype="noteOff",e.noteNumber=i,e.velocity=t.readInt8(),e;case 9:return e.noteNumber=i,e.velocity=t.readInt8(),0===e.velocity?e.subtype="noteOff":e.subtype="noteOn",e;case 10:return e.subtype="noteAftertouch",e.noteNumber=i,e.amount=t.readInt8(),e;case 11:return e.subtype="controller",e.controllerType=i,e.value=t.readInt8(),e;case 12:return e.subtype="programChange",e.programNumber=i,e;case 13:return e.subtype="channelAftertouch",e.amount=i,e;case 14:return e.subtype="pitchBend",e.value=i+(t.readInt8()<<7),e;default:throw new Error("Unrecognised MIDI event type: "+s)}}}let a=t;(t instanceof ArrayBuffer||"undefined"!==typeof e&&t instanceof e)&&(a=Array.from(new Uint8Array(t)).map(t=>String.fromCharCode(t)).join(""));const o=i(a),c=n(o);if("MThd"!==c.id||6!==c.length)throw new Error("Bad .mid file - header not found");const l=i(c.data),u=l.readInt16(),d=l.readInt16(),h=l.readInt16();let p;if(32768&h)throw new Error("Expressing time division in SMTPE frames is not supported yet");p=h;const f={formatType:u,trackCount:d,ticksPerBeat:p},m=[];for(let e=0;e<f.trackCount;e++){m[e]=[];const t=n(o);if("MTrk"!==t.id)throw new Error("Unexpected chunk - expected MTrk, got "+t.id);const r=i(t.data);while(!r.eof()){const t=s(r);m[e].push(t)}}return{header:f,tracks:m}}}).call(this,n("b639").Buffer)},"50be":function(t,e){t.exports=function(t){let e=0;function n(n){const i=t.substr(e,n);return e+=n,i}function i(){const n=(t.charCodeAt(e)<<24)+(t.charCodeAt(e+1)<<16)+(t.charCodeAt(e+2)<<8)+t.charCodeAt(e+3);return e+=4,n}function r(){const n=(t.charCodeAt(e)<<8)+t.charCodeAt(e+1);return e+=2,n}function s(n){let i=t.charCodeAt(e);return n&&i>127&&(i-=256),e+=1,i}function a(){return e>=t.length}function o(){let t=0;while(1){const e=s();if(!(128&e))return t+e;t+=127&e,t<<=7}}return{eof:a,read:n,readInt32:i,readInt16:r,readInt8:s,readVarInt:o}}},6445:function(t,e,n){"use strict";e["a"]={created(){this.quitCleaner=new Promise(t=>this.quitClear=t)},methods:{async appendCleaner(t){"pending"!==await Promise.race([this.quitCleaner,"pending"])?t():this.quitCleaner=this.quitCleaner.then(t)}},beforeDestroy(){this.quitClear()}}},"6be5":function(t,e,n){},"822d":function(t,e,n){"use strict";var i=n("6be5"),r=n.n(i);r.a},8701:function(t,e,n){"use strict";n.d(e,"a",(function(){return i})),"function"===typeof File&&(File.prototype.readAs=function(t){return new Promise(e=>{const n=new FileReader;n.onload=()=>e(n.result),n[`readAs${t}`](this)})});const i=(t,e)=>{const n=document.createElement("a");n.setAttribute("download",e),n.href=t,n.click()}},"8d04":function(t,e,n){"use strict";n.r(e);var i=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{directives:[{name:"resize",rawName:"v-resize",value:t.onResize,expression:"onResize"}],staticClass:"spiral-piano",class:{"drag-hover":t.drageHover,"touch-hover":t.touchHolding},on:{dragover:function(e){e.preventDefault(),t.drageHover=!0},dragleave:function(e){t.drageHover=!1},drop:function(e){return e.preventDefault(),t.onDropFiles(e)},touchstart:t.onTouchStart,touchend:t.onTouchEnd}},[n("svg",{staticClass:"canvas",class:{"full-width":t.fullWidth,"full-height":!t.fullWidth},attrs:{viewBox:"-500 -500 1000 1000"}},[n("defs",[n("filter",{attrs:{id:"filter-brilliancy"}},[n("feColorMatrix",{attrs:{type:"saturate",values:"1.2"}})],1),n("filter",{attrs:{id:"filter-middle-saturate"}},[n("feColorMatrix",{attrs:{type:"saturate",values:"0.7"}})],1),n("filter",{attrs:{id:"filter-grey"}},[n("feColorMatrix",{attrs:{type:"saturate",values:"0.06"}})],1),n("filter",{attrs:{id:"filter-brightness-n4"}},[n("feComponentTransfer",[n("feFuncR",{attrs:{type:"linear",intercept:"-0.4",slope:"1"}}),n("feFuncG",{attrs:{type:"linear",intercept:"-0.4",slope:"1"}}),n("feFuncB",{attrs:{type:"linear",intercept:"-0.4",slope:"1"}})],1)],1),n("filter",{attrs:{id:"filter-brightness-n3"}},[n("feComponentTransfer",[n("feFuncR",{attrs:{type:"linear",intercept:"-0.3",slope:"1"}}),n("feFuncG",{attrs:{type:"linear",intercept:"-0.3",slope:"1"}}),n("feFuncB",{attrs:{type:"linear",intercept:"-0.3",slope:"1"}})],1)],1),n("filter",{attrs:{id:"filter-brightness-n2"}},[n("feComponentTransfer",[n("feFuncR",{attrs:{type:"linear",intercept:"-0.2",slope:"1"}}),n("feFuncG",{attrs:{type:"linear",intercept:"-0.2",slope:"1"}}),n("feFuncB",{attrs:{type:"linear",intercept:"-0.2",slope:"1"}})],1)],1),n("filter",{attrs:{id:"filter-brightness-n1"}},[n("feComponentTransfer",[n("feFuncR",{attrs:{type:"linear",intercept:"-0.1",slope:"1"}}),n("feFuncG",{attrs:{type:"linear",intercept:"-0.1",slope:"1"}}),n("feFuncB",{attrs:{type:"linear",intercept:"-0.1",slope:"1"}})],1)],1),n("filter",{attrs:{id:"filter-brightness-1"}},[n("feComponentTransfer",[n("feFuncR",{attrs:{type:"linear",intercept:"0.1",slope:"1"}}),n("feFuncG",{attrs:{type:"linear",intercept:"0.1",slope:"1"}}),n("feFuncB",{attrs:{type:"linear",intercept:"0.1",slope:"1"}})],1)],1),n("filter",{attrs:{id:"filter-brightness-2"}},[n("feComponentTransfer",[n("feFuncR",{attrs:{type:"linear",intercept:"0.2",slope:"1"}}),n("feFuncG",{attrs:{type:"linear",intercept:"0.2",slope:"1"}}),n("feFuncB",{attrs:{type:"linear",intercept:"0.2",slope:"1"}})],1)],1),n("filter",{attrs:{id:"filter-brightness-3"}},[n("feComponentTransfer",[n("feFuncR",{attrs:{type:"linear",intercept:"0.3",slope:"1"}}),n("feFuncG",{attrs:{type:"linear",intercept:"0.3",slope:"1"}}),n("feFuncB",{attrs:{type:"linear",intercept:"0.3",slope:"1"}})],1)],1),n("filter",{attrs:{id:"filter-brightness-4"}},[n("feComponentTransfer",[n("feFuncR",{attrs:{type:"linear",intercept:"0.4",slope:"1"}}),n("feFuncG",{attrs:{type:"linear",intercept:"0.4",slope:"1"}}),n("feFuncB",{attrs:{type:"linear",intercept:"0.4",slope:"1"}})],1)],1),n("filter",{attrs:{id:"filter-brightness-5"}},[n("feComponentTransfer",[n("feFuncR",{attrs:{type:"linear",intercept:"0.5",slope:"1"}}),n("feFuncG",{attrs:{type:"linear",intercept:"0.5",slope:"1"}}),n("feFuncB",{attrs:{type:"linear",intercept:"0.5",slope:"1"}})],1)],1)]),n("g",{staticClass:"regions"},t._l(t.regions,(function(e,i){return n("path",{key:i,staticClass:"region",class:{main:e.main,deputy:!e.main},attrs:{d:"M0,0 L"+e.point.x+","+e.point.y+" A"+t.Config.RegionRadius+","+t.Config.RegionRadius+" 0 0,0 "+t.regions[e.nextIndex].point.x+","+t.regions[e.nextIndex].point.y+" Z"}})})),0),n("g",{staticClass:"labels"}),n("g",{staticClass:"keys"},[n("g",{staticClass:"labels"},t._l(t.mode.SyllableNames,(function(e,i){return n("text",{directives:[{name:"show",rawName:"v-show",value:null!=e,expression:"name != null"}],key:i,staticClass:"syllable",attrs:{x:Math.cos(t.regions[i].angle)*(t.Config.InnerRadius-8),y:Math.sin(t.regions[i].angle)*(t.Config.InnerRadius-8)+3}},[t._v(" "+t._s(e)+" ")])})),0),n("g",{staticClass:"groups"},t._l(t.groups,(function(e,i){return n("g",{key:i,staticClass:"group",attrs:{"data-index":e.index}},t._l(e.keys,(function(e,i){return n("path",{key:i,staticClass:"key",class:{active:t.keyStatus[e.pitch].active},attrs:{"data-pitch":e.pitch,"data-step":e.step,d:e.path},on:{mousedown:function(n){return n.stopPropagation(),t.onKeyDown(e.pitch)},mouseup:function(n){return t.onKeyUp(e.pitch)},touchstart:function(n){return n.stopPropagation(),n.preventDefault(),t.onKeyDown(e.pitch)},touchend:function(n){return n.preventDefault(),t.onKeyUp(e.pitch)}}})})),0)})),0)])]),n("div",{directives:[{name:"show",rawName:"v-show",value:t.showDashboard,expression:"showDashboard"}],staticClass:"dashboard"},[n("table",[n("tbody",[n("tr",[n("th"),n("td",[n("MidiDevices",{on:{midiInput:t.onMidiInputMessage}})],1)]),n("tr",[n("th",[t._v("Pitch Range")]),n("td",[n("input",{directives:[{name:"model",rawName:"v-model.number",value:t.wideRange.Start,expression:"wideRange.Start",modifiers:{number:!0}}],attrs:{type:"range",min:"21",max:t.wideRange.End-1},domProps:{value:t.wideRange.Start},on:{__r:function(e){t.$set(t.wideRange,"Start",t._n(e.target.value))},blur:function(e){return t.$forceUpdate()}}}),n("input",{directives:[{name:"model",rawName:"v-model.number",value:t.wideRange.End,expression:"wideRange.End",modifiers:{number:!0}}],attrs:{type:"range",min:t.wideRange.Start+1,max:"108"},domProps:{value:t.wideRange.End},on:{__r:function(e){t.$set(t.wideRange,"End",t._n(e.target.value))},blur:function(e){return t.$forceUpdate()}}}),n("span",[t._v("["+t._s(t.wideRange.Start)+" - "+t._s(t.wideRange.End)+"]")])])]),n("tr",[n("th",[t._v("Modal")]),n("td",[n("input",{directives:[{name:"model",rawName:"v-model.number",value:t.modalOffset,expression:"modalOffset",modifiers:{number:!0}}],attrs:{type:"range",min:"-7",max:7},domProps:{value:t.modalOffset},on:{__r:function(e){t.modalOffset=t._n(e.target.value)},blur:function(e){return t.$forceUpdate()}}}),t._v(" "+t._s(t.modalOffset)+" ")])]),t.midiFileName?n("tr",[n("th"),n("td",[n("button",{on:{click:t.onPlayFile}},[t._v(t._s(t.isPlaying?"⏸":"▶"))]),n("span",[t._v(t._s(t.midiFileName))])])]):t._e()])]),n("input",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],ref:"filePicker",attrs:{type:"file",accept:"audio/midi"},on:{change:t.onFileOpen}})]),n("div",{directives:[{name:"show",rawName:"v-show",value:t.isPlaying&&!t.showDashboard,expression:"isPlaying && !showDashboard"}],staticClass:"tips"},[t._v(" F9 show controls. ")]),t.loading?n("Loading"):t._e()],1)},r=[],s=n("428d"),a=n.n(s),o=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("svg",{attrs:{xmlns:"http://www.w3.org/2000/svg",viewBox:t.viewBox,height:t.height},on:{click:t.onClickCanvas}},[n("g",{attrs:{transform:"translate("+-t.xScroll+", 0)"}},[t.progressTime?n("g",{staticClass:"progress"},[n("rect",{attrs:{x:0,y:-120,height:121-t.notations.keyRange.low,width:t.progressTime*t.timeScale}}),n("line",{attrs:{x1:t.progressTime*t.timeScale,x2:t.progressTime*t.timeScale,y1:1-t.notations.keyRange.low,y2:"-120"}})]):t._e(),t.notations?n("g",t._l(t.notations.bars,(function(e,i){return n("g",{key:i,staticClass:"bar"},[0===e.index?n("line",{attrs:{x1:e.time*t.timeScale,x2:e.time*t.timeScale,y1:1-t.notations.keyRange.low,y2:"-120"}}):t._e()])})),0):t._e(),t.notations?n("SvgPianoRoll",{attrs:{notations:t.notations,timeScale:t.timeScale,pitchScale:1}}):t._e()],1),t.notations?n("g",{staticClass:"scales"},[n("rect",{staticClass:"pitch-padding",attrs:{x:-10,y:-120,width:10,height:121-t.notations.keyRange.low}}),n("line",{attrs:{x1:"0",x2:"0",y1:1-t.notations.keyRange.low,y2:"-120"}}),n("line",{attrs:{x1:"0",x2:t.timeScale*t.notations.endTime-t.xScroll,y1:1-t.notations.keyRange.low,y2:1-t.notations.keyRange.low}}),t._l(t.pitchScales,(function(e){return n("g",{key:"p-"+e,staticClass:"pitch-bar"},[n("line",{attrs:{x1:"-.8",x2:"0",y1:.5-e,y2:.5-e}}),n("text",{attrs:{x:"-2",y:1-e}},[t._v(t._s(e))])])})),n("g",{attrs:{transform:"translate("+-t.xScroll+", 0)"}},t._l(t.timeScales,(function(e){return n("g",{key:"t-"+e,staticClass:"time-bar"},[n("line",{attrs:{x1:e*t.timeScale,x2:e*t.timeScale,y1:1-t.notations.keyRange.low,y2:1.8-t.notations.keyRange.low}}),n("text",{attrs:{x:e*t.timeScale,y:4-t.notations.keyRange.low}},[t._v(t._s(.001*e)+"s")])])})),0)],2):t._e()])},c=[],l=n("2b0e"),u=n("b6e5"),d=n("af1b"),h=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("g",{staticClass:"piano-roll-root"},t._l(t.notations.notes,(function(e,i){return n("rect",{key:i,staticClass:"note",class:Object.assign({},{focus:e.index===t.focusNoteIndex},e.classes||{},{on:e.on}),attrs:{x:e.start*t.timeScale,y:-e.pitch*t.pitchScale,width:e.duration*t.timeScale,height:t.pitchScale},on:{click:function(n){return t.onClickNote(e)}}})})),0)},p=[],f={name:"svg-piano-roll",props:{notations:Object,timeScale:{type:Number,default:.001},pitchScale:{type:Number,default:1},focusNoteIndex:Number},methods:{onClickNote(t){this.$emit("clickNote",t)}}},m=f,g=(n("2036"),n("0c7c")),y=Object(g["a"])(m,h,p,!1,null,"709439ab",null),A=y.exports;const w={left:3,right:1};var b={name:"midi-roll",props:{midiURL:String,player:Object,height:{type:Number,default:200},width:Number,timeScale:{type:Number,default:.001}},components:{SvgPianoRoll:A},data(){return{notations:null,timeScroll:0}},computed:{widthLimited(){return Number.isFinite(this.width)},aspectRatio(){return this.widthLimited?this.width/this.height:1.6},viewHeight(){if(this.notations){const{low:t,high:e}=this.notations.keyRange;return e-t+5}return 90},viewWidth(){const t=this.notations?this.notations.endTime:this.height*this.aspectRatio,e=t*this.timeScale+w.left+w.right;return this.widthLimited?Math.min(e,this.width*this.viewHeight/this.height):e},viewBox(){return`-${w.left} ${this.notations?-this.notations.keyRange.high-1:0} ${this.viewWidth} ${this.viewHeight}`},pitchScales(){return this.notations?Array(9).fill().map((t,e)=>12*e).filter(t=>t>=this.notations.keyRange.low):[]},timeScales(){return this.notations?Array(Math.ceil(this.notations.endTime/15e3)).fill().map((t,e)=>15e3*e):[]},progressTime(){return this.player?this.player.progressTime:null},visibleTimeSpan(){return this.widthLimited?(this.viewWidth-(w.left+w.right))/this.timeScale:1/0},xScroll(){return this.timeScroll*this.timeScale}},created(){this.load()},methods:{async load(){if(this.notations=null,this.player)this.notations=this.player.notations,this.updateNoteStatus(),this.$forceUpdate();else if(this.midiURL){const t=await(await fetch(this.midiURL)).arrayBuffer(),e=Object(u["parseMidiData"])(t);this.notations=d["Notation"].parseMidi(e)}},updateNoteStatus(){if(!this.notations)return;const t=Number.isFinite(this.progressTime);for(const e of this.notations.notes)l["a"].set(e,"on",t&&e.start<this.progressTime&&e.start+e.duration>this.progressTime)},onClickCanvas(t){if(this.player){const e=(this.notations.keyRange.high-this.notations.keyRange.low+5)/this.height,n=t.offsetX*e-w.left+this.xScroll,i=n/this.timeScale;i>=0&&i<this.notations.endTime&&this.player.turnCursor(i)}},adjustTimeScroll(){this.progressTime-this.timeScroll>.6*this.visibleTimeSpan?this.timeScroll=Math.min(this.progressTime-.6*this.visibleTimeSpan,this.notations.endTime-this.visibleTimeSpan):this.progressTime-this.timeScroll<.4*this.visibleTimeSpan&&(this.timeScroll=Math.max(this.progressTime-.4*this.visibleTimeSpan,0))}},watch:{midiURL:"load",player:"load",progressTime(){this.updateNoteStatus(),this.widthLimited&&this.adjustTimeScroll()}}},k=b,v=(n("02f6"),Object(g["a"])(k,o,c,!1,null,"d5770ba0",null)),I=(v.exports,n("2f3d")),S=n.n(I);const x={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",decodeArrayBuffer:function(t){const e=Math.ceil(3*t.length/4),n=new ArrayBuffer(e);return this.decode(t,n),n},decode:function(t,e){const n=this._keyStr.indexOf(t.charAt(t.length-1)),i=this._keyStr.indexOf(t.charAt(t.length-1));let r,s,a,o,c,l,u,d,h=Math.ceil(3*t.length/4);64===n&&h--,64===i&&h--;let p=0,f=0;for(r=e?new Uint8Array(e):new Uint8Array(h),t=t.replace(/[^A-Za-z0-9+/=]/g,""),p=0;p<h;p+=3)c=this._keyStr.indexOf(t.charAt(f++)),l=this._keyStr.indexOf(t.charAt(f++)),u=this._keyStr.indexOf(t.charAt(f++)),d=this._keyStr.indexOf(t.charAt(f++)),s=c<<2|l>>4,a=(15&l)<<4|u>>2,o=(3&u)<<6|d,r[p]=s,64!==u&&(r[p+1]=a),64!==d&&(r[p+2]=o);return r}};var T=x;const q=window.MIDI||{};window.MIDI=q;const C=function(t){q.api=t.api,q.setVolume=t.setVolume,q.programChange=t.programChange,q.noteOn=t.noteOn,q.noteOff=t.noteOff,q.chordOn=t.chordOn,q.chordOff=t.chordOff,q.stopAllNotes=t.stopAllNotes,q.getInput=t.getInput,q.getOutputs=t.getOutputs};(function(){var t=null,e=null;const n=q.WebMIDI={api:"webmidi"};n.setVolume=function(t,n){e.send([176+t,7,n])},n.programChange=function(t,n){e.send([192+t,n])},n.noteOn=function(t,n,i,r){e.send([144+t,n,i],1e3*r)},n.noteOff=function(t,n,i){e.send([128+t,n,0],1e3*i)},n.chordOn=function(t,n,i,r){for(var s=0;s<n.length;s++){var a=n[s];e.send([144+t,a,i],1e3*r)}},n.chordOff=function(t,n,i){for(var r=0;r<n.length;r++){var s=n[r];e.send([128+t,s,0],1e3*i)}},n.stopAllNotes=function(){for(var t=0;t<16;t++)e.send([176+t,123,0])},n.getInput=function(){return t.getInputs()},n.getOutputs=function(){return t.getOutputs()},n.connect=function(i){C(n),navigator.requestMIDIAccess().then((function(n){t=n;const r=[...t.outputs];e=r[i.outputDeviceIndex||0][1],i.callback&&i.callback()}),(function(){window.AudioContext||window.webkitAudioContext?i.api="webaudio":window.Audio?i.api="audiotag":i.api="flash",q.loadPlugin(i)}))}})(),(window.AudioContext||window.webkitAudioContext)&&function(){if(window.MIDI&&window.MIDI.WebAudio)return void(q.WebAudio=window.MIDI.WebAudio);const t=window.AudioContext||window.webkitAudioContext,e=q.WebAudio={api:"webaudio",pendingInstruments:{}};let n;const i={};let r=127;const s={},a=function(t,e,i,r,a){const o=q.GeneralMIDI.byName[t],c=o.number,l=e[i];if(!q.Soundfont[t][l])return a(t);const u=q.Soundfont[t][l].split(",")[1],d=T.decodeArrayBuffer(u);n.decodeAudioData(d,(function(n){let u=l;while(u.length<3)u+="&nbsp;";if("undefined"!==typeof q.loader&&q.loader.update(null,o.instrument+"<br>Processing: "+(i/87*100>>0)+"%<br>"+u),n.id=l,r[i]=n,r.length===e.length){while(r.length){if(n=r.pop(),!n)continue;const t=q.keyToNote[n.id];s[c+""+t]=n}a(t)}}))},o=t=>Math.max(.001*(t-performance.now())+n.currentTime,0);e.setVolume=function(t,e){r=e},e.empty=function(){return!Object.keys(s).length},e.hasPending=function(){return!Object.keys(e.pendingInstruments).length},e.programChange=function(t,e){q.channels[t].instrument=e},e.noteOn=function(t,e,a,c=0){if(!q.channels[t])return;const l=q.channels[t].instrument;if(!s[l+""+e])return;const u=o(c),d=n.createBufferSource();i[t+""+e]=d,d.buffer=s[l+""+e],d.connect(n.destination),n.createGain?d.gainNode=n.createGain():d.gainNode=n.createGainNode();const h=a/127*(r/127)*2-1;return d.gainNode.connect(n.destination),d.gainNode.gain.setTargetAtTime(Math.max(-1,h),n.currentTime,0),d.connect(d.gainNode),d.noteOn?d.noteOn(u):d.start(u),d},e.noteOff=function(t,e,n=0){const r=o(n),s=i[t+""+e];if(s){if(s.gainNode){const t=s.gainNode.gain;t.linearRampToValueAtTime(t.value,r),t.linearRampToValueAtTime(-1,r+.2)}s.noteOff?s.noteOff(r+.3):s.stop(r+.3),delete i[t+""+e]}},e.chordOn=function(t,n,i,r){for(var s,a={},o=0,c=n.length;o<c;o++)a[s=n[o]]=e.noteOn(t,s,i,r);return a},e.chordOff=function(t,n,i){for(var r,s={},a=0,o=n.length;a<o;a++)s[r=n[a]]=e.noteOff(t,r,i);return s},e.stopAllNotes=function(){for(var t in i){var e=0;e<n.currentTime&&(e+=n.currentTime),i[t].gainNode.gain.linearRampToValueAtTime(1,e),i[t].gainNode.gain.linearRampToValueAtTime(0,e+.2),delete i[t]}},e.connect=function(i){C(e),n=new t;const r=[];for(const t in q.keyToNote)r.push(t);const s=[],o={},c=function(t){for(var e in delete o[t],o)break;!e&&i.callback&&i.callback()};for(const t in q.Soundfont){o[t]=!0;for(let e=0;e<r.length;e++)a(t,r,e,s,c)}}}(),window.Audio&&function(){const t=q.AudioTag={api:"audiotag"};for(var e={},n=127,i=-1,r=[],s=[],a={},o=0;o<12;o++)r[o]=new Audio;var c=function(t,e){if(q.channels[t]){var o=q.channels[t].instrument,c=q.GeneralMIDI.byId[o].id,l=a[e];if(l){var u=c+""+l.id,d=(i+1)%r.length,h=r[d];s[d]=u,h.src=q.Soundfont[c][l.id],h.volume=n/127,h.play(),i=d}}},l=function(t,e){if(q.channels[t]){var n=q.channels[t].instrument,o=q.GeneralMIDI.byId[n].id,c=a[e];if(c)for(var l=o+""+c.id,u=0;u<r.length;u++){var d=(u+i+1)%r.length,h=s[d];if(h&&h===l)return r[d].pause(),void(s[d]=null)}}};t.programChange=function(t,e){q.channels[t].instrument=e},t.setVolume=function(t,e){n=e},t.noteOn=function(t,n,i,r){var s=e[n];if(a[s])return r?window.setTimeout((function(){c(t,s)}),1e3*r):void c(t,s)},t.noteOff=function(t,n,i){var r=e[n];if(a[r])return i?setTimeout((function(){l(t,r)}),1e3*i):void l(t,r)},t.chordOn=function(t,n,i,r){for(var s=0;s<n.length;s++){var o=n[s],l=e[o];if(a[l]){if(r)return window.setTimeout((function(){c(t,l)}),1e3*r);c(t,l)}}},t.chordOff=function(t,n,i){for(var r=0;r<n.length;r++){var s=n[r],o=e[s];if(a[o]){if(i)return window.setTimeout((function(){l(t,o)}),1e3*i);l(t,o)}}},t.stopAllNotes=function(){for(var t=0,e=r.length;t<e;t++)r[t].pause()},t.connect=function(n){for(var i in console.log("AudioTag.connect:",n),q.keyToNote)e[q.keyToNote[i]]=i,a[i]={id:i};C(t),n.callback&&n.callback()}}(),q.GeneralMIDI=function(t){var e=function(t){return t.replace(/[^a-z0-9 ]/gi,"").replace(/[ ]/g,"_").toLowerCase()},n={byName:{},byId:{},byCategory:{}};for(var i in t)for(var r=t[i],s=0,a=r.length;s<a;s++){var o=r[s];if(o){var c=parseInt(o.substr(0,o.indexOf(" ")),10);o=o.replace(c+" ",""),n.byId[--c]=n.byName[e(o)]=n.byCategory[e(i)]={id:e(o),instrument:o,number:c,category:i}}}return n}({Piano:["1 Acoustic Grand Piano","2 Bright Acoustic Piano","3 Electric Grand Piano","4 Honky-tonk Piano","5 Electric Piano 1","6 Electric Piano 2","7 Harpsichord","8 Clavinet"],"Chromatic Percussion":["9 Celesta","10 Glockenspiel","11 Music Box","12 Vibraphone","13 Marimba","14 Xylophone","15 Tubular Bells","16 Dulcimer"],Organ:["17 Drawbar Organ","18 Percussive Organ","19 Rock Organ","20 Church Organ","21 Reed Organ","22 Accordion","23 Harmonica","24 Tango Accordion"],Guitar:["25 Acoustic Guitar (nylon)","26 Acoustic Guitar (steel)","27 Electric Guitar (jazz)","28 Electric Guitar (clean)","29 Electric Guitar (muted)","30 Overdriven Guitar","31 Distortion Guitar","32 Guitar Harmonics"],Bass:["33 Acoustic Bass","34 Electric Bass (finger)","35 Electric Bass (pick)","36 Fretless Bass","37 Slap Bass 1","38 Slap Bass 2","39 Synth Bass 1","40 Synth Bass 2"],Strings:["41 Violin","42 Viola","43 Cello","44 Contrabass","45 Tremolo Strings","46 Pizzicato Strings","47 Orchestral Harp","48 Timpani"],Ensemble:["49 String Ensemble 1","50 String Ensemble 2","51 Synth Strings 1","52 Synth Strings 2","53 Choir Aahs","54 Voice Oohs","55 Synth Choir","56 Orchestra Hit"],Brass:["57 Trumpet","58 Trombone","59 Tuba","60 Muted Trumpet","61 French Horn","62 Brass Section","63 Synth Brass 1","64 Synth Brass 2"],Reed:["65 Soprano Sax","66 Alto Sax","67 Tenor Sax","68 Baritone Sax","69 Oboe","70 English Horn","71 Bassoon","72 Clarinet"],Pipe:["73 Piccolo","74 Flute","75 Recorder","76 Pan Flute","77 Blown Bottle","78 Shakuhachi","79 Whistle","80 Ocarina"],"Synth Lead":["81 Lead 1 (square)","82 Lead 2 (sawtooth)","83 Lead 3 (calliope)","84 Lead 4 (chiff)","85 Lead 5 (charang)","86 Lead 6 (voice)","87 Lead 7 (fifths)","88 Lead 8 (bass + lead)"],"Synth Pad":["89 Pad 1 (new age)","90 Pad 2 (warm)","91 Pad 3 (polysynth)","92 Pad 4 (choir)","93 Pad 5 (bowed)","94 Pad 6 (metallic)","95 Pad 7 (halo)","96 Pad 8 (sweep)"],"Synth Effects":["97 FX 1 (rain)","98 FX 2 (soundtrack)","99 FX 3 (crystal)","100 FX 4 (atmosphere)","101 FX 5 (brightness)","102 FX 6 (goblins)","103 FX 7 (echoes)","104 FX 8 (sci-fi)"],Ethnic:["105 Sitar","106 Banjo","107 Shamisen","108 Koto","109 Kalimba","110 Bagpipe","111 Fiddle","112 Shanai"],Percussive:["113 Tinkle Bell","114 Agogo","115 Steel Drums","116 Woodblock","117 Taiko Drum","118 Melodic Tom","119 Synth Drum"],"Sound effects":["120 Reverse Cymbal","121 Guitar Fret Noise","122 Breath Noise","123 Seashore","124 Bird Tweet","125 Telephone Ring","126 Helicopter","127 Applause","128 Gunshot"]}),q.channels=function(){for(var t={},e=0;e<16;e++)t[e]={instrument:0,mute:!1,mono:!1,omni:!1,solo:!1};return t}(),q.pianoKeyOffset=21,q.keyToNote={},q.noteToKey={},function(){for(var t=21,e=108,n=["C","Db","D","Eb","E","F","Gb","G","Ab","A","Bb","B"],i=t;i<=e;i++){var r=(i-12)/12>>0,s=n[i%12]+r;q.keyToNote[s]=i,q.noteToKey[i]=s}}();var M=q;const R={};let B=0;const E=function(t){B++;const e=new Audio,n=t.split(";")[0];e.id="audio",e.setAttribute("preload","auto"),e.setAttribute("audiobuffer",!0),e.addEventListener("error",(function(){R[n]=!1,B--}),!1),e.addEventListener("canplaythrough",(function(){R[n]=!0,B--}),!1),e.src="data:"+t,document.body.appendChild(e)};function N(t){if("undefined"===typeof Audio)return t({});const e=new Audio;if("undefined"===typeof e.canPlayType)return t(R);let n=e.canPlayType('audio/ogg; codecs="vorbis"');n="probably"===n||"maybe"===n;let i=e.canPlayType("audio/mpeg");if(i="probably"===i||"maybe"===i,!n&&!i)return void t(R);n&&E("audio/ogg;base64,T2dnUwACAAAAAAAAAADqnjMlAAAAAOyyzPIBHgF2b3JiaXMAAAAAAUAfAABAHwAAQB8AAEAfAACZAU9nZ1MAAAAAAAAAAAAA6p4zJQEAAAANJGeqCj3//////////5ADdm9yYmlzLQAAAFhpcGguT3JnIGxpYlZvcmJpcyBJIDIwMTAxMTAxIChTY2hhdWZlbnVnZ2V0KQAAAAABBXZvcmJpcw9CQ1YBAAABAAxSFCElGVNKYwiVUlIpBR1jUFtHHWPUOUYhZBBTiEkZpXtPKpVYSsgRUlgpRR1TTFNJlVKWKUUdYxRTSCFT1jFloXMUS4ZJCSVsTa50FkvomWOWMUYdY85aSp1j1jFFHWNSUkmhcxg6ZiVkFDpGxehifDA6laJCKL7H3lLpLYWKW4q91xpT6y2EGEtpwQhhc+211dxKasUYY4wxxsXiUyiC0JBVAAABAABABAFCQ1YBAAoAAMJQDEVRgNCQVQBABgCAABRFcRTHcRxHkiTLAkJDVgEAQAAAAgAAKI7hKJIjSZJkWZZlWZameZaouaov+64u667t6roOhIasBACAAAAYRqF1TCqDEEPKQ4QUY9AzoxBDDEzGHGNONKQMMogzxZAyiFssLqgQBKEhKwKAKAAAwBjEGGIMOeekZFIi55iUTkoDnaPUUcoolRRLjBmlEluJMYLOUeooZZRCjKXFjFKJscRUAABAgAMAQICFUGjIigAgCgCAMAYphZRCjCnmFHOIMeUcgwwxxiBkzinoGJNOSuWck85JiRhjzjEHlXNOSuekctBJyaQTAAAQ4AAAEGAhFBqyIgCIEwAwSJKmWZomipamiaJniqrqiaKqWp5nmp5pqqpnmqpqqqrrmqrqypbnmaZnmqrqmaaqiqbquqaquq6nqrZsuqoum65q267s+rZru77uqapsm6or66bqyrrqyrbuurbtS56nqqKquq5nqq6ruq5uq65r25pqyq6purJtuq4tu7Js664s67pmqq5suqotm64s667s2rYqy7ovuq5uq7Ks+6os+75s67ru2rrwi65r66os674qy74x27bwy7ouHJMnqqqnqq7rmarrqq5r26rr2rqmmq5suq4tm6or26os67Yry7aumaosm64r26bryrIqy77vyrJui67r66Ys67oqy8Lu6roxzLat+6Lr6roqy7qvyrKuu7ru+7JuC7umqrpuyrKvm7Ks+7auC8us27oxuq7vq7It/KosC7+u+8Iy6z5jdF1fV21ZGFbZ9n3d95Vj1nVhWW1b+V1bZ7y+bgy7bvzKrQvLstq2scy6rSyvrxvDLux8W/iVmqratum6um7Ksq/Lui60dd1XRtf1fdW2fV+VZd+3hV9pG8OwjK6r+6os68Jry8ov67qw7MIvLKttK7+r68ow27qw3L6wLL/uC8uq277v6rrStXVluX2fsSu38QsAABhwAAAIMKEMFBqyIgCIEwBAEHIOKQahYgpCCKGkEEIqFWNSMuakZM5JKaWUFEpJrWJMSuaclMwxKaGUlkopqYRSWiqlxBRKaS2l1mJKqcVQSmulpNZKSa2llGJMrcUYMSYlc05K5pyUklJrJZXWMucoZQ5K6iCklEoqraTUYuacpA46Kx2E1EoqMZWUYgupxFZKaq2kFGMrMdXUWo4hpRhLSrGVlFptMdXWWqs1YkxK5pyUzDkqJaXWSiqtZc5J6iC01DkoqaTUYiopxco5SR2ElDLIqJSUWiupxBJSia20FGMpqcXUYq4pxRZDSS2WlFosqcTWYoy1tVRTJ6XFklKMJZUYW6y5ttZqDKXEVkqLsaSUW2sx1xZjjqGkFksrsZWUWmy15dhayzW1VGNKrdYWY40x5ZRrrT2n1mJNMdXaWqy51ZZbzLXnTkprpZQWS0oxttZijTHmHEppraQUWykpxtZara3FXEMpsZXSWiypxNhirLXFVmNqrcYWW62ltVprrb3GVlsurdXcYqw9tZRrrLXmWFNtBQAADDgAAASYUAYKDVkJAEQBAADGMMYYhEYpx5yT0ijlnHNSKucghJBS5hyEEFLKnINQSkuZcxBKSSmUklJqrYVSUmqttQIAAAocAAACbNCUWByg0JCVAEAqAIDBcTRNFFXVdX1fsSxRVFXXlW3jVyxNFFVVdm1b+DVRVFXXtW3bFn5NFFVVdmXZtoWiqrqybduybgvDqKqua9uybeuorqvbuq3bui9UXVmWbVu3dR3XtnXd9nVd+Bmzbeu2buu+8CMMR9/4IeTj+3RCCAAAT3AAACqwYXWEk6KxwEJDVgIAGQAAgDFKGYUYM0gxphhjTDHGmAAAgAEHAIAAE8pAoSErAoAoAADAOeecc84555xzzjnnnHPOOeecc44xxhhjjDHGGGOMMcYYY4wxxhhjjDHGGGOMMcYYY0wAwE6EA8BOhIVQaMhKACAcAABACCEpKaWUUkoRU85BSSmllFKqFIOMSkoppZRSpBR1lFJKKaWUIqWgpJJSSimllElJKaWUUkoppYw6SimllFJKKaWUUkoppZRSSimllFJKKaWUUkoppZRSSimllFJKKaWUUkoppZRSSimllFJKKaWUUkoppZRSSimllFJKKaVUSimllFJKKaWUUkoppRQAYPLgAACVYOMMK0lnhaPBhYasBAByAwAAhRiDEEJpraRUUkolVc5BKCWUlEpKKZWUUqqYgxBKKqmlklJKKbXSQSihlFBKKSWUUkooJYQQSgmhlFRCK6mEUkoHoYQSQimhhFRKKSWUzkEoIYUOQkmllNRCSB10VFIpIZVSSiklpZQ6CKGUklJLLZVSWkqpdBJSKamV1FJqqbWSUgmhpFZKSSWl0lpJJbUSSkklpZRSSymFVFJJJYSSUioltZZaSqm11lJIqZWUUkqppdRSSiWlkEpKqZSSUmollZRSaiGVlEpJKaTUSimlpFRCSamlUlpKLbWUSkmptFRSSaWUlEpJKaVSSksppRJKSqmllFpJKYWSUkoplZJSSyW1VEoKJaWUUkmptJRSSymVklIBAEAHDgAAAUZUWoidZlx5BI4oZJiAAgAAQABAgAkgMEBQMApBgDACAQAAAADAAAAfAABHARAR0ZzBAUKCwgJDg8MDAAAAAAAAAAAAAACAT2dnUwAEAAAAAAAAAADqnjMlAgAAADzQPmcBAQA="),i&&E("audio/mpeg;base64,/+MYxAAAAANIAUAAAASEEB/jwOFM/0MM/90b/+RhST//w4NFwOjf///PZu////9lns5GFDv//l9GlUIEEIAAAgIg8Ir/JGq3/+MYxDsLIj5QMYcoAP0dv9HIjUcH//yYSg+CIbkGP//8w0bLVjUP///3Z0x5QCAv/yLjwtGKTEFNRTMuOTeqqqqqqqqqqqqq/+MYxEkNmdJkUYc4AKqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq");const r=(new Date).getTime(),s=window.setInterval((function(){const e=(new Date).getTime(),n=e-r>5e3;B&&!n||(window.clearInterval(s),t(R))}),1)}const F=function(){return this.loaded={},this.loading={},this};F.prototype.add=function(t){const e=this;"string"===typeof t&&(t={src:t});let n=t.srcs;"undefined"===typeof n&&(n=[{src:t.src,verify:t.verify}]);const i=document.getElementsByTagName("head")[0],r=function(t,n){e.loaded[t.src]||n&&"undefined"===typeof window[n]||(e.loaded[t.src]=!0,e.loading[t.src]&&e.loading[t.src](),delete e.loading[t.src],t.callback&&t.callback(),"undefined"!==typeof getNext&&getNext())},s=[],a=function(n){if("string"===typeof n&&(n={src:n,verify:t.verify}),/([\w\d.])$/.test(n.verify))if(n.test=n.verify,"object"===typeof n.test)for(const t in n.test)s.push(n.test[t]);else s.push(n.test);if(e.loaded[n.src])return;const a=document.createElement("script");a.onreadystatechange=function(){"loaded"!==this.readyState&&"complete"!==this.readyState||r(n)},a.onload=function(){r(n)},a.onerror=function(){},a.setAttribute("type","text/javascript"),a.setAttribute("src",n.src),i.appendChild(a),e.loading[n.src]=function(){}},o=function(e){if(e)r(e,e.test);else for(let t=0;t<n.length;t++)r(n[t],n[t].test);let i=!0;for(let t=0;t<s.length;t++){let e=s[t];if(e&&-1!==e.indexOf(".")){e=e.split(".");const t=window[e[0]];if("undefined"===typeof t)continue;2===e.length?"undefined"===typeof t[e[1]]&&(i=!1):3===e.length&&"undefined"===typeof t[e[1]][e[2]]&&(i=!1)}else"undefined"===typeof window[e]&&(i=!1)}!t.strictOrder&&i?t.callback&&t.callback():setTimeout((function(){o(e)}),10)};if(t.strictOrder){let i=-1;const r=function(){if(i++,n[i]){const t=n[i],s=t.src;e.loading[s]?e.loading[s]=function(){t.callback&&t.callback(),r()}:e.loaded[s]?r():(a(t),o(t))}else t.callback&&t.callback()};r()}else{for(let t=0;t<n.length;t++)a(n[t]);o()}};const K=new F;var O=K;function P(t){fetch(t.url,t.data).then(t=>t.text()).then(e=>{t.onload&&t.onload({responseText:e})}).catch(e=>{console.warn("DOMLoader.sendRequest error:",e),t.onerror&&t.onerror(e,!1)})}const D={script:O,sendRequest:P};M.Soundfont=window.MIDI&&window.MIDI.Soundfont||{},window.MIDI=M,M.audioDetect=N;const U=!1,W={};M.loadPlugin=function(t={}){"function"===typeof t&&(t={callback:t});var e=t.instruments||t.instrument||"acoustic_grand_piano";"object"!==typeof e&&(e=[e]);for(var n=0;n<e.length;n++){var i=e[n];"number"===typeof i&&(e[n]=M.GeneralMIDI.byId[i])}if(M.soundfontUrl=t.soundfontUrl||M.soundfontUrl||"./soundfont/",M.audioDetect((function(n){var i="";if(i=V[t.api]?t.api:U&&navigator.requestMIDIAccess?"webmidi":window.webkitAudioContext||window.AudioContext?"webaudio":window.Audio?"audiotag":"flash",!W[i])return;let r;r=t.targetFormat?t.targetFormat:n["audio/ogg"]?"ogg":"mp3",M.lang=i,M.supports=n,W[i](r,e,t)})),!t.callback)return new Promise(e=>t.callback=e)},W.webmidi=function(t,e,n){M.loader&&M.loader.message("Web MIDI API..."),M.WebMIDI.connect(n)},W.flash=function(t,e,n){M.loader&&M.loader.message("Flash API..."),D.script.add({src:n.soundManagerUrl||"./inc/SoundManager2/script/soundmanager2.js",verify:"SoundManager",callback:function(){M.Flash.connect(e,n)}})},W.audiotag=function(t,e,n){M.loader&&M.loader.message("HTML5 Audio API...");const i=J({items:e,getNext(e){M.Soundfont[e]?i.getNext():D.sendRequest({url:M.soundfontUrl+e+"-"+t+".js",onprogress:G,onload(t){L(t.responseText),M.loader&&M.loader.update(null,"Downloading",100),i.getNext()}})},onComplete(){M.AudioTag.connect(n)}})},W.webaudio=function(t,e,n){M.loader&&M.loader.message("Web Audio API...");const i=J({items:e,getNext(n){M.Soundfont[n]?i.getNext():(M.WebAudio.pendingInstruments[e]=!0,D.sendRequest({url:M.soundfontUrl+n+"-"+t+".js",onprogress:G,onload(t){L(t.responseText),M.loader&&M.loader.update(null,"Downloading...",100),i.getNext(),delete M.WebAudio.pendingInstruments[e]},onerror(t){M.loader&&M.loader.update(t,"Download failed."),delete M.WebAudio.pendingInstruments[e]}}))},onComplete(){M.WebAudio.connect(n)}})};const V={webmidi:!0,webaudio:!0,audiotag:!0,flash:!0},L=function(t){var e=document.createElement("script");e.language="javascript",e.type="text/javascript",e.text=t,document.body.appendChild(e)},G=function(t){this.totalSize||(this.getResponseHeader("Content-Length-Raw")?this.totalSize=parseInt(this.getResponseHeader("Content-Length-Raw")):this.totalSize=t.total);const e=this.totalSize?Math.round(t.loaded/this.totalSize*100):"";M.loader&&M.loader.update(null,"Downloading...",e)},J=function(t){const e={queue:[]};for(const n in t.items)t.items.hasOwnProperty(n)&&e.queue.push(t.items[n]);return e.getNext=function(){if(!e.queue.length)return t.onComplete();t.getNext(e.queue.shift())},setTimeout(e.getNext,1),e};M.loadPlugin;var Y=M,Z=(n("8701"),function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"midi-devices"},[t.navigatorSupported?n("div",[n("select",{ref:"inputList",staticClass:"input-list",attrs:{title:"Choose a MIDI Input Device",disabled:t.loading||0==t.inputDevices.length},on:{change:t.updateInputConnection}},[t._l(t.inputDevices,(function(e){return n("option",{key:e.id,domProps:{value:e.id,selected:e.id===t.value}},[t._v(" "+t._s(e.name)+" ")])})),0==t.inputDevices.length?n("option",[t._v(" No Connection ")]):t._e()],2),n("button",{staticClass:"refresh",on:{click:t.refreshInputList}},[t._v("🔄")])]):t._e(),t.navigatorSupported?t._e():n("div",{staticClass:"unsupported"},[t._v(" The browser does not supported "),n("a",{attrs:{href:"https://www.w3.org/TR/webmidi/",target:"_blank"}},[t._v("WebMIDI APIs")]),t._v(". ")])])}),j=[],Q={name:"midi-devices",props:{value:String},mounted(){navigator.requestMIDIAccess&&(this.loading=!0,navigator.requestMIDIAccess().then(t=>{this.MidiAccess=t,this.refreshInputList()}))},beforeDestroyed(){if(this.MidiAccess){const t=this.MidiAccess.inputs.values();for(const e of t)e.onmidimessage=null}},data(){return{inputDevices:[],loading:!1}},computed:{navigatorSupported(){return navigator.requestMIDIAccess}},methods:{refreshInputList(){this.MidiAccess&&(this.loading=!0,this.inputDevices=[...this.MidiAccess.inputs.values()],this.$nextTick(()=>this.updateInputConnection()))},updateInputConnection(){if(this.$refs.inputList){const t=this.MidiAccess.inputs.values();for(const e of t)e.onmidimessage=e.id===this.$refs.inputList.value?t=>this.$emit("midiInput",t):null;this.$emit("input",this.$refs.inputList.value)}this.loading=!1}}},_=Q,H=(n("c773"),Object(g["a"])(_,Z,j,!1,null,"6215e310",null)),X=H.exports,z=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"loading",style:"background-image: url("+t.imgURL+")"})},$=[],tt=n("1823"),et=n.n(tt),nt={name:"loading",data(){return{imgURL:et.a}}},it=nt,rt=(n("822d"),Object(g["a"])(it,z,$,!1,null,"c59fbadc",null)),st=rt.exports,at=n("6445");const ot={GroupLen:12,InnerRadius:30,ScrewPitch:4,KeyCount:88,NoteStart:21,NoteEnd:108,MiddleC:60,RegionRadius:400,Mode:{Major:{MainPitches:{0:!0,2:!0,4:!0,5:!0,7:!0,9:!0,11:!0},SyllableNames:["do",null,"re",null,"mi","fa",null,"so",null,"la",null,"ti"]},Minor:{MainPitches:{0:!0,2:!0,3:!0,5:!0,7:!0,8:!0,11:!0},SyllableNames:["do",null,"re","mi",null,"fa",null,"so","la",null,null,"ti"]}},KeySerials:{White:[0,2,4,5,7,9,11]},SpanKeyWidth:9},ct=function(t){return ot.NoteEnd-t},lt=function(t){let e=t%ot.GroupLen;return e<0&&(e+=ot.GroupLen),e},ut=function(t){return Math.floor(t/ot.GroupLen)},dt=function(t){let e=7*t%12;while(e<-5)e+=12;while(e>6)e-=12;return e},ht=function(t,e){const n=[],i=(t+e)/2,r=(t-e)/2;for(let o=0;o<ot.KeyCount+ot.GroupLen+1;++o){const t=(ct(o)-i)/r;n[o]=Math.exp(-t*t*t*t/2)}const s=n.reduce((t,e)=>t+e,0),a=12*(.9*ot.RegionRadius-ot.InnerRadius)/s;return n.map(t=>t*a)};var pt={name:"spiral-piano",directives:{resize:a.a},mixins:[at["a"]],components:{MidiDevices:X,Loading:st},data(){return{Config:ot,size:null,extends:null,keyRadius:Array(ot.KeyCount+ot.GroupLen+1).fill().map((t,e)=>ot.InnerRadius+e*ot.ScrewPitch/ot.GroupLen),keyPoints:null,modalOffset:0,keyWidthRatio:.5,mode:ot.Mode.Major,wideRange:{Start:54,End:77},synesthesiaScheme:"FifthRainbow",keyStatus:Array(ot.NoteEnd+1).fill().map(()=>({active:!1})),showDashboard:!1,drageHover:!1,midiFileName:null,loading:!0,touchHolding:!1,player:null}},computed:{fullWidth(){return this.size&&this.size.height>this.size.width},regions(){return Array(ot.GroupLen).fill().map((t,e)=>{const n=Math.PI*(1.5+2*e/ot.GroupLen),i=Math.PI*(1.5+2*(e+this.getOffsetAngles(e))/ot.GroupLen);return{angle:n,boderAngle:i,point:{x:Math.cos(i)*ot.RegionRadius,y:Math.sin(i)*ot.RegionRadius},nextIndex:e>0?e-1:ot.GroupLen-1,main:lt(e+this.modalOffset)in this.mode.MainPitches}})},keys(){return this.keyPoints?Array(ot.KeyCount).fill().map((t,e)=>{const n=ct(e),i=ut(n),[r,s,a,o]=[e,e+1,e+ot.GroupLen+1,e+ot.GroupLen];return{pitch:n,group:i,step:lt(n),path:`M${this.keyPoints[r].x},${this.keyPoints[r].y}\n\t\t\t\t\t\tA${this.keyRadius[r]},${this.keyRadius[r]} 0 0 0 ${this.keyPoints[s].x},${this.keyPoints[s].y}\n\t\t\t\t\t\tL${this.keyPoints[a].x},${this.keyPoints[a].y}\n\t\t\t\t\t\tA${this.keyRadius[o]},${this.keyRadius[o]} 0 0 1 ${this.keyPoints[o].x},${this.keyPoints[o].y}\n\t\t\t\t\t\tZ`.replace(/\n/g,"")}}):null},groups(){return this.keys?Array(9).fill().map((t,e)=>({index:e+1,keys:this.keys.filter(t=>t.group===e+1)})):null},wideRangeHash(){return`${this.wideRange.Start}|${this.wideRange.End}`},isPlaying(){return this.player&&this.player.isPlaying}},created(){Y.WebAudio.empty()?Y.loadPlugin({soundfontUrl:"/soundfont/",api:"webaudio"}).then(()=>{this.loading=!1,console.log("Soundfont loaded."),this.appendCleaner(()=>{Y.stopAllNotes(),this.player&&this.player.dispose()})}):this.loading=!1},mounted(){this.updateKeyRadius(),window.addEventListener("keydown",t=>{switch(t.keyCode){case 120:this.showDashboard=!this.showDashboard;break}})},methods:{onResize(){this.size={width:this.$el.clientWidth,height:this.$el.clientHeight}},async loadFile(t){switch(t.type){case"audio/mid":case"audio/midi":this.player&&this.player.dispose(),this.loading=!0;const e=await t.readAs("ArrayBuffer"),n=u.parseMidiData(e);this.player=new S.a(n,{onMidi:(t,e)=>this.onMidi(t,e)}),console.log("MIDI file loaded."),this.midiFileName=t.name,this.onPlayFile(),this.loading=!1;break}},onMidi(t,e){if(!Y.WebAudio.empty())switch(t.subtype){case"noteOn":this.activateKey(t.noteNumber,!0),Y.noteOn(t.channel,t.noteNumber,t.velocity,e);break;case"noteOff":this.activateKey(t.noteNumber,!1),Y.noteOff(t.channel,t.noteNumber,e);break;case"keySignature":this.modalOffset=dt(t.key);break}},onDropFiles(t){this.drageHover=!1,this.loadFile(t.dataTransfer.files[0])},onFileOpen(t){this.loadFile(t.target.files[0])},onPlayFile(){this.isPlaying?this.player.pause():this.player.play()},async onTouchStart(){this.touchHolding=!0;try{await new Promise((t,e)=>{this.interruptTouch=e,setTimeout(t,1600)}),this.$refs.filePicker.click(),this.touchHolding=!1,this.showDashboard=!0}catch(t){}},onTouchEnd(){this.touchHolding=!1,this.interruptTouch&&(this.interruptTouch(),this.interruptTouch=null)},updateKeyRadius(){this.extends=ht(this.wideRange.Start,this.wideRange.End);for(let t=0;t<ot.KeyCount+ot.GroupLen+1;++t){let e=0;for(let n=Math.floor(t/ot.GroupLen);n>0;--n)e+=this.extends[t-n*ot.GroupLen];this.keyRadius[t]=ot.InnerRadius+t*ot.ScrewPitch/ot.GroupLen+e}this.keyPoints=Array(ot.KeyCount+ot.GroupLen+1).fill().map((t,e)=>{const n=this.getOffsetAngles(ct(e)-this.modalOffset),i=Math.PI*(1.5-2*(this.modalOffset+e-n)/ot.GroupLen),r=(this.keyRadius[e]+(e>0?this.keyRadius[e-1]:this.keyRadius[e]))/2;return{x:Math.cos(i)*r,y:Math.sin(i)*r}})},getOffsetAngles(t){const e=[lt(t+1)in this.mode.MainPitches,lt(t)in this.mode.MainPitches];return e[0]===e[1]?.5:e[0]?1-this.keyWidthRatio:this.keyWidthRatio},activateKey(t,e){this.keyStatus[t].active=e},onKeyDown(t){this.activateKey(t,!0),Y.noteOn(0,t,100,0)},onKeyUp(t){this.activateKey(t,!1),Y.noteOff(0,t,0)},onMidiInputMessage(t){const e=t.data[0]>>4,n=15&t.data[0],i=t.data[1],r=t.data[2];switch(e){case 9:if(r>0){this.activateKey(i,!0),Y.noteOn(n,i,r,0);break}case 8:this.activateKey(i,!1),Y.noteOff(n,i,0);break}}},watch:{wideRangeHash:"updateKeyRadius"}},ft=pt,mt=(n("4003"),Object(g["a"])(ft,i,r,!1,null,"2b268ddd",null));e["default"]=mt.exports},"92ff":function(t,e,n){},9779:function(t,e,n){},"9b39":function(t,e,n){const i=n("ee6a");t.exports=function({header:t,tracks:e}){function n(t,e,n){console.assert(4===e.length,"chunk id must be 4 byte"),t.write(e),t.writeInt32(n.length),t.write(n)}function r(t,e){if("unknown"!==e.subtype)switch(t.writeVarInt(e.deltaTime),e.type){case"meta":switch(t.writeInt8(255),e.subtype){case"sequenceNumber":t.writeInt8(0),t.writeVarInt(2),t.writeInt16(e.number);break;case"text":t.writeInt8(1),t.writeVarInt(e.text.length),t.write(e.text);break;case"copyrightNotice":t.writeInt8(2),t.writeVarInt(e.text.length),t.write(e.text);break;case"trackName":t.writeInt8(3),t.writeVarInt(e.text.length),t.write(e.text);break;case"instrumentName":t.writeInt8(4),t.writeVarInt(e.text.length),t.write(e.text);break;case"lyrics":t.writeInt8(5),t.writeVarInt(e.text.length),t.write(e.text);break;case"marker":t.writeInt8(6),t.writeVarInt(e.text.length),t.write(e.text);break;case"cuePoint":t.writeInt8(7),t.writeVarInt(e.text.length),t.write(e.text);break;case"midiChannelPrefix":t.writeInt8(32),t.writeVarInt(1),t.writeInt8(e.channel);break;case"endOfTrack":t.writeInt8(47),t.writeVarInt(0);break;case"setTempo":t.writeInt8(81),t.writeVarInt(3),t.writeInt8(e.microsecondsPerBeat>>16&255),t.writeInt8(e.microsecondsPerBeat>>8&255),t.writeInt8(255&e.microsecondsPerBeat);break;case"smpteOffset":t.writeInt8(84),t.writeVarInt(5);var n={24:0,25:32,29:64,30:96}[e.frameRate];t.writeInt8(e.hour|n),t.writeInt8(e.min),t.writeInt8(e.sec),t.writeInt8(e.frame),t.writeInt8(e.subframe);break;case"timeSignature":t.writeInt8(88),t.writeVarInt(4),t.writeInt8(e.numerator),t.writeInt8(Math.log(e.denominator)/Math.log(2)),t.writeInt8(e.metronome),t.writeInt8(e.thirtyseconds);break;case"keySignature":t.writeInt8(89),t.writeVarInt(2),t.writeInt8(e.key),t.writeInt8(e.scale);break;case"sequencerSpecific":t.writeInt8(127),t.writeVarInt(e.data.length),t.write(e.data);break;default:throw new Error("unhandled event subtype:"+e.subtype)}break;case"sysEx":t.writeInt8(240),t.writeVarInt(e.data.length),t.write(e.data);break;case"dividedSysEx":t.writeInt8(247),t.writeVarInt(e.data.length),t.write(e.data);break;case"channel":switch(e.subtype){case"noteOn":t.writeInt8(144|e.channel),t.writeInt8(e.noteNumber),t.writeInt8(e.velocity);break;case"noteOff":t.writeInt8(128|e.channel),t.writeInt8(e.noteNumber),t.writeInt8(e.velocity?e.velocity:0);break;case"noteAftertouch":t.writeInt8(160|e.channel),t.writeInt8(e.noteNumber),t.writeInt8(e.amount);break;case"controller":t.writeInt8(176|e.channel),t.writeInt8(e.controllerType),t.writeInt8(e.value);break;case"programChange":t.writeInt8(192|e.channel),t.writeInt8(e.programNumber);break;case"channelAftertouch":t.writeInt8(208|e.channel),t.writeInt8(e.amount);break;case"pitchBend":t.writeInt8(224|e.channel),t.writeInt8(255&e.value),t.writeInt8(e.value>>7&255);break;default:throw new Error("unhandled event subtype:"+e.subtype)}break;default:throw new Error("unhandled event type:"+e.type)}}const s=new i,a=new i;a.writeInt16(t.formatType),a.writeInt16(e.length),a.writeInt16(t.ticksPerBeat),n(s,"MThd",a.getBuffer());for(let o=0;o<e.length;++o){const t=new i;for(let n=0;n<e[o].length;++n)r(t,e[o][n]);n(s,"MTrk",t.getBuffer())}return s.getBuffer()}},af1b:function(t,e){const n={64:"Sustain",65:"Portamento",66:"Sostenuto",67:"Soft"},i=(t,e=1)=>{const n=[];let i=120;const r=t.header.ticksPerBeat;for(let l=0;l<t.tracks.length;l++)n[l]={nextEventIndex:0,ticksToNextEvent:t.tracks[l].length?t.tracks[l][0].deltaTime:null};function s(){let e=null,i=null,r=null;for(let t=0;t<n.length;t++)null!=n[t].ticksToNextEvent&&(null==e||n[t].ticksToNextEvent<e)&&(e=n[t].ticksToNextEvent,i=t,r=n[t].nextEventIndex);if(null!=i){const s=t.tracks[i][r];t.tracks[i][r+1]?n[i].ticksToNextEvent+=t.tracks[i][r+1].deltaTime:n[i].ticksToNextEvent=null,n[i].nextEventIndex+=1;for(let t=0;t<n.length;t++)null!=n[t].ticksToNextEvent&&(n[t].ticksToNextEvent-=e);return{ticksToEvent:e,event:s,track:i}}return null}let a;const o=[];function c(){function t(){"meta"==a.event.type&&"setTempo"==a.event.subtype&&(i=6e7/a.event.microsecondsPerBeat);let t=0;if(a.ticksToEvent>0){const e=a.ticksToEvent/r;t=e/(i/60)}const n=1e3*t*e||0;o.push([a,n]),a=s()}if(a=s())while(a)t()}return c(),o};class r{static parseMidi(t){const e=[],s={},a={},o=[],c=[];let l=0,u=5e3,d=0,h=4,p=0;const f={};let m,g=0,y=0;const A=[],w=t.header.ticksPerBeat,b=i(t),k=b.map(t=>({data:t[0].event,track:t[0].track,deltaTime:t[1],deltaTicks:t[0].ticksToEvent}));let v=0;const I=1;for(const i of k){if(g+=i.deltaTicks,y=Math.round(g*I),i.deltaTicks>0){const t=i.deltaTicks/w;for(let e=Math.ceil(d);e<d+t;++e){let t=l+(e-d)*u;c.push({time:t,index:p%h}),++p}d+=t}l+=i.deltaTime,i.time=l,i.ticks=y;const t=i.data;switch(t.type){case"channel":switch(t.subtype){case"noteOn":{const n=t.noteNumber;e.push({channel:t.channel,pitch:n,startTick:y,start:l,velocity:t.velocity,beats:d,track:i.track}),f.low=Math.min(f.low||n,n),i.index=v,++v}break;case"noteOff":{const n=t.noteNumber;o[t.channel]=o[t.channel]||[];const i=e.findIndex(e=>e.channel==t.channel&&e.pitch==n);if(i>=0){const r=e.splice(i,1)[0];o[t.channel].push({startTick:r.startTick,endTick:y,pitch:n,start:r.start,duration:l-r.start,velocity:r.velocity,beats:r.beats,track:r.track,finger:r.finger})}else console.warn("unexpected noteOff: ",l,t);f.high=Math.max(f.high||n,n)}break;case"controller":switch(t.controllerType){case 64:case 65:case 66:case 67:const e=n[t.controllerType];s[t.channel]=s[t.channel]||{},a[t.channel]=a[t.channel]||[];const i=s[t.channel][e];t.value>0?i||(s[t.channel][e]={start:l,value:t.value}):i&&(a[t.channel].push({type:e,start:i.start,duration:l-i.start,value:i.value}),s[t.channel][e]=null);break}break}break;case"meta":switch(t.subtype){case"setTempo":u=t.microsecondsPerBeat/1e3,A.push({tempo:t.microsecondsPerBeat,ticks:y,time:l});break;case"timeSignature":h=t.numerator,p=0;break;case"text":if(!m&&/^find-corres:/.test(t.text)){const e=t.text.match(/:([\d\,-]+)/),n=e&&e[1]||"";m=n.split(",").map(t=>Number(t))}else if(/fingering\(.*\)/.test(t.text)){const[n,i]=t.text.match(/\((.+)\)/),r=Number(i);if(!Number.isNaN(r)){const t=e[e.length-1];t&&(t.finger=r);const n=k.find(t=>t.index==v-1);n&&(n.data.finger=r)}}break;case"copyrightNotice":console.log("MIDI copyright:",t.text);break}break}}return e.forEach(t=>{console.warn("unclosed noteOn event at",t.startTick,t),o[t.channel].push({startTick:t.startTick,endTick:y,pitch:t.pitch,start:t.start,duration:l-t.start,velocity:t.velocity,beats:t.beats,track:t.track,finger:t.finger})}),new r({channels:o,keyRange:f,pedals:a,bars:c,endTime:l,endTick:y,correspondences:m,events:k,tempos:A,ticksPerBeat:w,meta:{}})}constructor(t){Object.assign(this,t),this.notes=[];for(const e of this.channels)if(e)for(const t of e)this.notes.push(t);this.notes.sort((function(t,e){return t.start-e.start}));for(const e in this.notes)this.notes[e].index=Number(e);this.duration=this.notes.length>0?this.endTime-this.notes[0].start:0,this.pitchMap=[];for(const e in this.channels)for(const t in this.channels[e]){const n=this.channels[e][t].pitch;this.pitchMap[n]=this.pitchMap[n]||[],this.pitchMap[n].push(this.channels[e][t])}if(this.pitchMap.forEach(t=>t.sort((t,e)=>t.start-e.start)),this.measures){const t=[];let e=null;const n=Object.entries(this.measures).sort((t,e)=>Number(t[0])-Number(e[0]));for(const[i,r]of n){r.startTick=Number(i),r.notes=[],e&&(e.endTick=r.startTick);const n=r.measure;t[n]=t[n]||[],t[n].push(r),e=r}e&&(e.endTick=this.notes[this.notes.length-1].endTick);for(const i in this.notes){const t=this.notes[i];for(const e in this.measures){const n=this.measures[e];(t.startTick>=n.startTick&&t.startTick<n.endTick||t.endTick>n.startTick&&t.endTick<=n.endTick)&&n.notes.push(t)}}this.measure_list=t}if(this.meta.beatInfos)for(let e=0;e<this.meta.beatInfos.length;++e){const t=this.meta.beatInfos[e];if(e>0){const n=this.meta.beatInfos[e-1];t.beatIndex=n.beatIndex+Math.ceil((t.tick-n.tick)/this.ticksPerBeat)}else t.beatIndex=0}{let t=0,e=0,n=5e5;for(const i of this.tempos){const r=i.tick-e;t+=n/1e3*r/this.ticksPerBeat,e=i.tick,n=i.tempo,i.time=t}}}findChordBySoftindex(t,e=.8){return this.notes.filter(n=>Math.abs(n.softIndex-t)<e)}averageTempo(t){t=t||{from:0,to:this.endtick},console.assert(this.tempos,"no tempos."),console.assert(t.to>t.from,"range is invalid:",t);const e=e=>{const n=Math.max(t.from,this.tempos[e].tick),i=e<this.tempos.length-1?Math.min(this.tempos[e+1].tick,t.to):t.to;return Math.max(0,i-n)},n=this.tempos.reduce((t,n,i)=>t+n.tempo*e(i),0),i=n/(t.to-t.from);return 6e7/i}ticksToTime(t){console.assert(Number.isFinite(t),"invalid ticks value:",t),console.assert(this.tempos&&this.tempos.length,"no tempos.");let e=this.tempos.findIndex(e=>e.tick>t)-1;e<0&&(e=this.tempos.length-1);const n=this.tempos[e];return n.time+(t-n.tick)*n.tempo*.001/this.ticksPerBeat}tickRangeToTimeRange(t){return console.assert(t.to>=t.from,"invalid tick range:",t),{from:this.ticksToTime(t.from),to:this.ticksToTime(t.to)}}getMeasureRange(t){console.assert(Number.isInteger(t.start)&&Number.isInteger(t.end),"invalid measure range:",t),console.assert(this.measure_list&&this.measure_list[t.start]&&this.measure_list[t.end],"no measure data for specific index:",this.measure_list,t);const e=this.measure_list[t.start][0];let n=null;for(const s of this.measure_list[t.end])if(s.endTick>e.startTick){n=s;break}if(!n)return null;const i={from:e.startTick,to:n.endTick,duration:n.endTick-e.startTick},r=this.tickRangeToTimeRange(i);return r.duration=r.to-r.from,{tickRange:i,timeRange:r}}}t.exports={Notation:r}},b6e5:function(t,e,n){t.exports={parseMidiData:n("4e44"),encodeMidiFile:n("9b39")}},c773:function(t,e,n){"use strict";var i=n("fbee"),r=n.n(i);r.a},d084:function(t,e,n){},ee6a:function(t,e){t.exports=class{constructor(){this.buffer=""}write(t){this.buffer+=t}writeInt32(t){this.buffer+=String.fromCharCode(t>>24&255)+String.fromCharCode(t>>16&255)+String.fromCharCode(t>>8&255)+String.fromCharCode(255&t)}writeInt16(t){this.buffer+=String.fromCharCode(t>>8&255)+String.fromCharCode(255&t)}writeInt8(t){this.buffer+=String.fromCharCode(255&t)}writeVarInt(t){if(t<0)throw new Error("OStream.writeVarInt minus number: "+t);const e=127&t;t>>=7;let n=String.fromCharCode(e);while(t){const e=127&t;t>>=7,n=String.fromCharCode(128|e)+n}this.buffer+=n}getBuffer(){return this.buffer}}},fbee:function(t,e,n){}}]);
//# sourceMappingURL=spiral-piano.60150d78.js.map