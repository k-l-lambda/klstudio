(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["spiral-piano","chunk-2d0abf9e"],{1823:function(e,t){e.exports="data:image/gif;base64,R0lGODlhrQBaAKIAAAQEBDQ0NOXl5X9/f+bm5oSEhHBwcAAAACH/C05FVFNDQVBFMi4wAwEAAAAh+QQFCgAHACwAAAAArQBaAAAD+Xi63P4wykmrvTjrzbv/YCiOZGmeaKqubOu+cCzPdG3feK7vfO//wKBwSCwaj8ikcslsOp/QqHRKrVqv2Kx2y+16v+CweEwum8/otHrNbrvf8Lh8Tq/b7/i8fs/vSwkCgQQQgIKEgoMPhYGHhnqIjgyQjA2TAg6WmJN5i5CSlokKnYifmQujkXWgl6egpZutpqKud6uvnrGws7IHtrW0u7q9wMO8vnaolMG4y6S5zMXCqtLRqc2st8rP2r/Wz43c34rOfuXm5+jp6uvs7e7v8PHy8/T19vf4+fr7/P3+/wADChxIsKDBgwgTKlzIsKHDhxAjSpxIsWKIBAAh+QQJCgAHACw2ACcACwALAAADGnh60LuhyQClpczarLv/GtcpUYcd5fQo0pMAACH5BAkKAAcALDcAJwAXAAsAAAM4eLrcB7CZMmoxLsAdVP0ftmgbd1CgxZTskYILK79fLJd0Zd8QmhYrnivHILE6h8mHkjk6no0NIwEAIfkECQoABwAsNwAnACQACwAAA1J4utz+B0hHhCXPlMGLcYEkBstlNlyafksojkdlXsymdsyrxzO93KqFbtjzKYAp4fBVtDCQHOVSIuvVkIXcVFFEQRkuHYl7cmhSG5AYwm5rAYwEACH5BAkKAAcALDcAJwAxAAsAAANmeLrc/tCB6Yi4BFr8TBlgYTjBZAYLplbq1YAwPC6leR5bm6W6u3yxEMNGxPUEjCNyEYwtiFBl8showp5Qm5TXq1oH2Owk15p2f9bCUKw4m1deK6NGRLXhLI7DA/uQ6hGBgoMKJgwJACH5BAkKAAcALDcAJwA+AAsAAAN6eLrc/jBKQB0RmMCbd9aOUQxkYTgBpQbL1zUuZsUNadvnkqrrwdGtmCwoZIxuJQZv6RMKGM4nEahA3hbLbBTq5BYXVhs2y9tOXV7qIUwakyk/9PmTliuOyILyrfjWh39SYGwMO0ssfXQPcR4vDSI2IyiHEpWWl5UqDAkAIfkECQoABwAsNwAoAD0ACQAAA2B4R9KkEDIX42xVupdNGWBhKBtVldiJZqhQgTBsXKXVcuRtt9EXhzeXhjdcFWuQXyy4M+aIT+dBCWMeN01kVDulDmjYq2kbJo8Pvl9hITWz2mxul7rN1O00ezxV8cA+BwkAIfkEBQoABwAsNwAoAD0ACQAAA0x4R9KkEDIX42xVupfX1puQhVhFiiY5qldonZzSfqBaw7YMvyefe7jejaYTFn/B3ZCyLB1dzaAP+iQCkTvjckXdpqitzjX2dZbJU0UCADs="},6445:function(e,t,i){"use strict";t["a"]={created(){this.quitCleaner=new Promise(e=>this.quitClear=e)},methods:{async appendCleaner(e){"pending"!==await Promise.race([this.quitCleaner,"pending"])?e():this.quitCleaner=this.quitCleaner.then(e)}},beforeDestroy(){this.quitClear()}}},"6be5":function(e,t,i){},"822d":function(e,t,i){"use strict";var n=i("6be5"),s=i.n(n);s.a},8701:function(e,t,i){"use strict";i.d(t,"a",(function(){return n})),"function"===typeof File&&(File.prototype.readAs=function(e){return new Promise(t=>{const i=new FileReader;i.onload=()=>t(i.result),i[`readAs${e}`](this)})});const n=(e,t)=>{const i=document.createElement("a");i.setAttribute("download",t),i.href=e,i.click()}},"8d04":function(e,t,i){"use strict";i.r(t);var n=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{directives:[{name:"resize",rawName:"v-resize",value:e.onResize,expression:"onResize"}],staticClass:"spiral-piano",class:{"drag-hover":e.drageHover,"touch-hover":e.touchHolding},on:{dragover:function(t){t.preventDefault(),e.drageHover=!0},dragleave:function(t){e.drageHover=!1},drop:function(t){return t.preventDefault(),e.onDropFiles(t)},touchstart:e.onTouchStart,touchend:e.onTouchEnd}},[i("svg",{staticClass:"canvas",class:{"full-width":e.fullWidth,"full-height":!e.fullWidth},attrs:{viewBox:"-500 -500 1000 1000"}},[i("defs",[i("filter",{attrs:{id:"filter-brilliancy"}},[i("feColorMatrix",{attrs:{type:"saturate",values:"1.2"}})],1),i("filter",{attrs:{id:"filter-middle-saturate"}},[i("feColorMatrix",{attrs:{type:"saturate",values:"0.7"}})],1),i("filter",{attrs:{id:"filter-grey"}},[i("feColorMatrix",{attrs:{type:"saturate",values:"0.06"}})],1),i("filter",{attrs:{id:"filter-brightness-n4"}},[i("feComponentTransfer",[i("feFuncR",{attrs:{type:"linear",intercept:"-0.4",slope:"1"}}),i("feFuncG",{attrs:{type:"linear",intercept:"-0.4",slope:"1"}}),i("feFuncB",{attrs:{type:"linear",intercept:"-0.4",slope:"1"}})],1)],1),i("filter",{attrs:{id:"filter-brightness-n3"}},[i("feComponentTransfer",[i("feFuncR",{attrs:{type:"linear",intercept:"-0.3",slope:"1"}}),i("feFuncG",{attrs:{type:"linear",intercept:"-0.3",slope:"1"}}),i("feFuncB",{attrs:{type:"linear",intercept:"-0.3",slope:"1"}})],1)],1),i("filter",{attrs:{id:"filter-brightness-n2"}},[i("feComponentTransfer",[i("feFuncR",{attrs:{type:"linear",intercept:"-0.2",slope:"1"}}),i("feFuncG",{attrs:{type:"linear",intercept:"-0.2",slope:"1"}}),i("feFuncB",{attrs:{type:"linear",intercept:"-0.2",slope:"1"}})],1)],1),i("filter",{attrs:{id:"filter-brightness-n1"}},[i("feComponentTransfer",[i("feFuncR",{attrs:{type:"linear",intercept:"-0.1",slope:"1"}}),i("feFuncG",{attrs:{type:"linear",intercept:"-0.1",slope:"1"}}),i("feFuncB",{attrs:{type:"linear",intercept:"-0.1",slope:"1"}})],1)],1),i("filter",{attrs:{id:"filter-brightness-1"}},[i("feComponentTransfer",[i("feFuncR",{attrs:{type:"linear",intercept:"0.1",slope:"1"}}),i("feFuncG",{attrs:{type:"linear",intercept:"0.1",slope:"1"}}),i("feFuncB",{attrs:{type:"linear",intercept:"0.1",slope:"1"}})],1)],1),i("filter",{attrs:{id:"filter-brightness-2"}},[i("feComponentTransfer",[i("feFuncR",{attrs:{type:"linear",intercept:"0.2",slope:"1"}}),i("feFuncG",{attrs:{type:"linear",intercept:"0.2",slope:"1"}}),i("feFuncB",{attrs:{type:"linear",intercept:"0.2",slope:"1"}})],1)],1),i("filter",{attrs:{id:"filter-brightness-3"}},[i("feComponentTransfer",[i("feFuncR",{attrs:{type:"linear",intercept:"0.3",slope:"1"}}),i("feFuncG",{attrs:{type:"linear",intercept:"0.3",slope:"1"}}),i("feFuncB",{attrs:{type:"linear",intercept:"0.3",slope:"1"}})],1)],1),i("filter",{attrs:{id:"filter-brightness-4"}},[i("feComponentTransfer",[i("feFuncR",{attrs:{type:"linear",intercept:"0.4",slope:"1"}}),i("feFuncG",{attrs:{type:"linear",intercept:"0.4",slope:"1"}}),i("feFuncB",{attrs:{type:"linear",intercept:"0.4",slope:"1"}})],1)],1),i("filter",{attrs:{id:"filter-brightness-5"}},[i("feComponentTransfer",[i("feFuncR",{attrs:{type:"linear",intercept:"0.5",slope:"1"}}),i("feFuncG",{attrs:{type:"linear",intercept:"0.5",slope:"1"}}),i("feFuncB",{attrs:{type:"linear",intercept:"0.5",slope:"1"}})],1)],1)]),i("g",{staticClass:"regions"},e._l(e.regions,(function(t,n){return i("path",{key:n,staticClass:"region",class:{main:t.main,deputy:!t.main},attrs:{d:"M0,0 L"+t.point.x+","+t.point.y+" A"+e.Config.RegionRadius+","+e.Config.RegionRadius+" 0 0,0 "+e.regions[t.nextIndex].point.x+","+e.regions[t.nextIndex].point.y+" Z"}})})),0),i("g",{staticClass:"labels"}),i("g",{staticClass:"keys"},[i("g",{staticClass:"labels"},e._l(e.mode.SyllableNames,(function(t,n){return i("text",{directives:[{name:"show",rawName:"v-show",value:null!=t,expression:"name != null"}],key:n,staticClass:"syllable",attrs:{x:Math.cos(e.regions[n].angle)*(e.Config.InnerRadius-8),y:Math.sin(e.regions[n].angle)*(e.Config.InnerRadius-8)+3}},[e._v(" "+e._s(t)+" ")])})),0),i("g",{staticClass:"groups"},e._l(e.groups,(function(t,n){return i("g",{key:n,staticClass:"group",attrs:{"data-index":t.index}},e._l(t.keys,(function(t,n){return i("path",{key:n,staticClass:"key",class:{active:e.keyStatus[t.pitch].active},attrs:{"data-pitch":t.pitch,"data-step":t.step,d:t.path},on:{mousedown:function(i){return i.stopPropagation(),e.onKeyDown(t.pitch)},mouseup:function(i){return e.onKeyUp(t.pitch)},touchstart:function(i){return i.stopPropagation(),i.preventDefault(),e.onKeyDown(t.pitch)},touchend:function(i){return i.preventDefault(),e.onKeyUp(t.pitch)}}})})),0)})),0)])]),i("div",{directives:[{name:"show",rawName:"v-show",value:e.showDashboard,expression:"showDashboard"}],staticClass:"dashboard"},[i("table",[i("tbody",[i("tr",[i("th"),i("td",[i("MidiDevices",{on:{midiInput:e.onMidiInputMessage}})],1)]),i("tr",[i("th",[e._v("Pitch Range")]),i("td",[i("input",{directives:[{name:"model",rawName:"v-model.number",value:e.wideRange.Start,expression:"wideRange.Start",modifiers:{number:!0}}],attrs:{type:"range",min:"21",max:e.wideRange.End-1},domProps:{value:e.wideRange.Start},on:{__r:function(t){e.$set(e.wideRange,"Start",e._n(t.target.value))},blur:function(t){return e.$forceUpdate()}}}),i("input",{directives:[{name:"model",rawName:"v-model.number",value:e.wideRange.End,expression:"wideRange.End",modifiers:{number:!0}}],attrs:{type:"range",min:e.wideRange.Start+1,max:"108"},domProps:{value:e.wideRange.End},on:{__r:function(t){e.$set(e.wideRange,"End",e._n(t.target.value))},blur:function(t){return e.$forceUpdate()}}}),i("span",[e._v("["+e._s(e.wideRange.Start)+" - "+e._s(e.wideRange.End)+"]")])])]),i("tr",[i("th",[e._v("Modal")]),i("td",[i("input",{directives:[{name:"model",rawName:"v-model.number",value:e.modalOffset,expression:"modalOffset",modifiers:{number:!0}}],attrs:{type:"range",min:"-7",max:7},domProps:{value:e.modalOffset},on:{__r:function(t){e.modalOffset=e._n(t.target.value)},blur:function(t){return e.$forceUpdate()}}}),e._v(" "+e._s(e.modalOffset)+" ")])]),e.midiFileName?i("tr",[i("th"),i("td",[i("button",{on:{click:e.onPlayFile}},[e._v(e._s(e.isPlaying?"⏸":"▶"))]),i("span",[e._v(e._s(e.midiFileName))])])]):e._e()])]),i("input",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],ref:"filePicker",attrs:{type:"file",accept:"audio/midi"},on:{change:e.onFileOpen}})]),i("div",{directives:[{name:"show",rawName:"v-show",value:e.isPlaying&&!e.showDashboard,expression:"isPlaying && !showDashboard"}],staticClass:"tips"},[e._v(" F9 show controls. ")]),e.loading?i("Loading"):e._e()],1)},s=[],a=i("428d"),r=i.n(a),o=i("caea"),l=(i("8701"),function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"midi-devices"},[e.navigatorSupported?i("div",[i("select",{ref:"inputList",staticClass:"input-list",attrs:{title:"Choose a MIDI Input Device",disabled:e.loading||0==e.inputDevices.length},on:{change:e.updateInputConnection}},[e._l(e.inputDevices,(function(t){return i("option",{key:t.id,domProps:{value:t.id,selected:t.id===e.value}},[e._v(" "+e._s(t.name)+" ")])})),0==e.inputDevices.length?i("option",[e._v(" No Connection ")]):e._e()],2),i("button",{staticClass:"refresh",on:{click:e.refreshInputList}},[e._v("🔄")])]):e._e(),e.navigatorSupported?e._e():i("div",{staticClass:"unsupported"},[e._v(" The browser does not supported "),i("a",{attrs:{href:"https://www.w3.org/TR/webmidi/",target:"_blank"}},[e._v("WebMIDI APIs")]),e._v(". ")])])}),u=[],d={name:"midi-devices",props:{value:String},mounted(){navigator.requestMIDIAccess&&(this.loading=!0,navigator.requestMIDIAccess().then(e=>{this.MidiAccess=e,this.refreshInputList()}))},beforeDestroyed(){if(this.MidiAccess){const e=this.MidiAccess.inputs.values();for(const t of e)t.onmidimessage=null}},data(){return{inputDevices:[],loading:!1}},computed:{navigatorSupported(){return navigator.requestMIDIAccess}},methods:{refreshInputList(){this.MidiAccess&&(this.loading=!0,this.inputDevices=[...this.MidiAccess.inputs.values()],this.$nextTick(()=>this.updateInputConnection()))},updateInputConnection(){if(this.$refs.inputList){const e=this.MidiAccess.inputs.values();for(const t of e)t.onmidimessage=t.id===this.$refs.inputList.value?e=>this.$emit("midiInput",e):null;this.$emit("input",this.$refs.inputList.value)}this.loading=!1}}},c=d,p=(i("c773"),i("0c7c")),h=Object(p["a"])(c,l,u,!1,null,"6215e310",null),f=h.exports,y=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"loading",style:"background-image: url("+e.imgURL+")"})},g=[],m=i("1823"),A=i.n(m),v={name:"loading",data(){return{imgURL:A.a}}},w=v,b=(i("822d"),Object(p["a"])(w,y,g,!1,null,"c59fbadc",null)),C=b.exports,k=i("6445");const R={GroupLen:12,InnerRadius:30,ScrewPitch:4,KeyCount:88,NoteStart:21,NoteEnd:108,MiddleC:60,RegionRadius:400,Mode:{Major:{MainPitches:{0:!0,2:!0,4:!0,5:!0,7:!0,9:!0,11:!0},SyllableNames:["do",null,"re",null,"mi","fa",null,"so",null,"la",null,"ti"]},Minor:{MainPitches:{0:!0,2:!0,3:!0,5:!0,7:!0,8:!0,11:!0},SyllableNames:["do",null,"re","mi",null,"fa",null,"so","la",null,null,"ti"]}},KeySerials:{White:[0,2,4,5,7,9,11]},SpanKeyWidth:9},M=function(e){return R.NoteEnd-e},I=function(e){let t=e%R.GroupLen;return t<0&&(t+=R.GroupLen),t},x=function(e){return Math.floor(e/R.GroupLen)},P=function(e){let t=7*e%12;while(t<-5)t+=12;while(t>6)t-=12;return t},F=function(e,t){const i=[],n=(e+t)/2,s=(e-t)/2;for(let o=0;o<R.KeyCount+R.GroupLen+1;++o){const e=(M(o)-n)/s;i[o]=Math.exp(-e*e*e*e/2)}const a=i.reduce((e,t)=>e+t,0),r=12*(.9*R.RegionRadius-R.InnerRadius)/a;return i.map(e=>e*r)};var D={name:"spiral-piano",directives:{resize:r.a},mixins:[k["a"]],components:{MidiDevices:f,Loading:C},data(){return{Config:R,size:null,extends:null,keyRadius:Array(R.KeyCount+R.GroupLen+1).fill().map((e,t)=>R.InnerRadius+t*R.ScrewPitch/R.GroupLen),keyPoints:null,modalOffset:0,keyWidthRatio:.5,mode:R.Mode.Major,wideRange:{Start:54,End:77},synesthesiaScheme:"FifthRainbow",keyStatus:Array(R.NoteEnd+1).fill().map(()=>({active:!1})),showDashboard:!1,drageHover:!1,midiFileName:null,loading:!0,touchHolding:!1,player:null}},computed:{fullWidth(){return this.size&&this.size.height>this.size.width},regions(){return Array(R.GroupLen).fill().map((e,t)=>{const i=Math.PI*(1.5+2*t/R.GroupLen),n=Math.PI*(1.5+2*(t+this.getOffsetAngles(t))/R.GroupLen);return{angle:i,boderAngle:n,point:{x:Math.cos(n)*R.RegionRadius,y:Math.sin(n)*R.RegionRadius},nextIndex:t>0?t-1:R.GroupLen-1,main:I(t+this.modalOffset)in this.mode.MainPitches}})},keys(){return this.keyPoints?Array(R.KeyCount).fill().map((e,t)=>{const i=M(t),n=x(i),[s,a,r,o]=[t,t+1,t+R.GroupLen+1,t+R.GroupLen];return{pitch:i,group:n,step:I(i),path:`M${this.keyPoints[s].x},${this.keyPoints[s].y}\n\t\t\t\t\t\tA${this.keyRadius[s]},${this.keyRadius[s]} 0 0 0 ${this.keyPoints[a].x},${this.keyPoints[a].y}\n\t\t\t\t\t\tL${this.keyPoints[r].x},${this.keyPoints[r].y}\n\t\t\t\t\t\tA${this.keyRadius[o]},${this.keyRadius[o]} 0 0 1 ${this.keyPoints[o].x},${this.keyPoints[o].y}\n\t\t\t\t\t\tZ`.replace(/\n/g,"")}}):null},groups(){return this.keys?Array(9).fill().map((e,t)=>({index:t+1,keys:this.keys.filter(e=>e.group===t+1)})):null},wideRangeHash(){return`${this.wideRange.Start}|${this.wideRange.End}`},isPlaying(){return this.player&&this.player.isPlaying}},created(){o["MidiAudio"].WebAudio.empty()?o["MidiAudio"].loadPlugin({soundfontUrl:"./soundfont/",api:"webaudio"}).then(()=>{this.loading=!1,console.log("Soundfont loaded."),this.appendCleaner(()=>{o["MidiAudio"].stopAllNotes(),this.player&&this.player.dispose()})}):this.loading=!1},mounted(){this.updateKeyRadius(),window.addEventListener("keydown",e=>{switch(e.keyCode){case 120:this.showDashboard=!this.showDashboard;break}})},methods:{onResize(){this.size={width:this.$el.clientWidth,height:this.$el.clientHeight}},async loadFile(e){switch(e.type){case"audio/mid":case"audio/midi":this.player&&this.player.dispose(),this.loading=!0;const t=await e.readAs("ArrayBuffer"),i=o["MIDI"].parseMidiData(t);this.player=new o["MidiPlayer"](i,{onMidi:(e,t)=>this.onMidi(e,t)}),console.log("MIDI file loaded."),this.midiFileName=e.name,this.onPlayFile(),this.loading=!1;break}},onMidi(e,t){if(!o["MidiAudio"].WebAudio.empty())switch(e.subtype){case"noteOn":this.activateKey(e.noteNumber,!0),o["MidiAudio"].noteOn(e.channel,e.noteNumber,e.velocity,t);break;case"noteOff":this.activateKey(e.noteNumber,!1),o["MidiAudio"].noteOff(e.channel,e.noteNumber,t);break;case"keySignature":this.modalOffset=P(e.key);break}},onDropFiles(e){this.drageHover=!1,this.loadFile(e.dataTransfer.files[0])},onFileOpen(e){this.loadFile(e.target.files[0])},onPlayFile(){this.isPlaying?this.player.pause():this.player.play()},async onTouchStart(){this.touchHolding=!0;try{await new Promise((e,t)=>{this.interruptTouch=t,setTimeout(e,1600)}),this.$refs.filePicker.click(),this.touchHolding=!1,this.showDashboard=!0}catch(e){}},onTouchEnd(){this.touchHolding=!1,this.interruptTouch&&(this.interruptTouch(),this.interruptTouch=null)},updateKeyRadius(){this.extends=F(this.wideRange.Start,this.wideRange.End);for(let e=0;e<R.KeyCount+R.GroupLen+1;++e){let t=0;for(let i=Math.floor(e/R.GroupLen);i>0;--i)t+=this.extends[e-i*R.GroupLen];this.keyRadius[e]=R.InnerRadius+e*R.ScrewPitch/R.GroupLen+t}this.keyPoints=Array(R.KeyCount+R.GroupLen+1).fill().map((e,t)=>{const i=this.getOffsetAngles(M(t)-this.modalOffset),n=Math.PI*(1.5-2*(this.modalOffset+t-i)/R.GroupLen),s=(this.keyRadius[t]+(t>0?this.keyRadius[t-1]:this.keyRadius[t]))/2;return{x:Math.cos(n)*s,y:Math.sin(n)*s}})},getOffsetAngles(e){const t=[I(e+1)in this.mode.MainPitches,I(e)in this.mode.MainPitches];return t[0]===t[1]?.5:t[0]?1-this.keyWidthRatio:this.keyWidthRatio},activateKey(e,t){this.keyStatus[e].active=t},onKeyDown(e){this.activateKey(e,!0),o["MidiAudio"].noteOn(0,e,100,0)},onKeyUp(e){this.activateKey(e,!1),o["MidiAudio"].noteOff(0,e,0)},onMidiInputMessage(e){const t=e.data[0]>>4,i=15&e.data[0],n=e.data[1],s=e.data[2];switch(t){case 9:if(s>0){this.activateKey(n,!0),o["MidiAudio"].noteOn(i,n,s,0);break}case 8:this.activateKey(n,!1),o["MidiAudio"].noteOff(i,n,0);break}}},watch:{wideRangeHash:"updateKeyRadius"}},L=D,K=(i("b941"),Object(p["a"])(L,n,s,!1,null,"197de0f2",null));t["default"]=K.exports},b941:function(e,t,i){"use strict";var n=i("bf71"),s=i.n(n);s.a},bf71:function(e,t,i){},c773:function(e,t,i){"use strict";var n=i("fbee"),s=i.n(n);s.a},fbee:function(e,t,i){}}]);
//# sourceMappingURL=spiral-piano.91398f29.js.map