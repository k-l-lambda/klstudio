(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["spiral-piano","chunk-2d0abf9e"],{1823:function(e,t){e.exports="data:image/gif;base64,R0lGODlhrQBaAKIAAAQEBDQ0NOXl5X9/f+bm5oSEhHBwcAAAACH/C05FVFNDQVBFMi4wAwEAAAAh+QQFCgAHACwAAAAArQBaAAAD+Xi63P4wykmrvTjrzbv/YCiOZGmeaKqubOu+cCzPdG3feK7vfO//wKBwSCwaj8ikcslsOp/QqHRKrVqv2Kx2y+16v+CweEwum8/otHrNbrvf8Lh8Tq/b7/i8fs/vSwkCgQQQgIKEgoMPhYGHhnqIjgyQjA2TAg6WmJN5i5CSlokKnYifmQujkXWgl6egpZutpqKud6uvnrGws7IHtrW0u7q9wMO8vnaolMG4y6S5zMXCqtLRqc2st8rP2r/Wz43c34rOfuXm5+jp6uvs7e7v8PHy8/T19vf4+fr7/P3+/wADChxIsKDBgwgTKlzIsKHDhxAjSpxIsWKIBAAh+QQJCgAHACw2ACcACwALAAADGnh60LuhyQClpczarLv/GtcpUYcd5fQo0pMAACH5BAkKAAcALDcAJwAXAAsAAAM4eLrcB7CZMmoxLsAdVP0ftmgbd1CgxZTskYILK79fLJd0Zd8QmhYrnivHILE6h8mHkjk6no0NIwEAIfkECQoABwAsNwAnACQACwAAA1J4utz+B0hHhCXPlMGLcYEkBstlNlyafksojkdlXsymdsyrxzO93KqFbtjzKYAp4fBVtDCQHOVSIuvVkIXcVFFEQRkuHYl7cmhSG5AYwm5rAYwEACH5BAkKAAcALDcAJwAxAAsAAANmeLrc/tCB6Yi4BFr8TBlgYTjBZAYLplbq1YAwPC6leR5bm6W6u3yxEMNGxPUEjCNyEYwtiFBl8showp5Qm5TXq1oH2Owk15p2f9bCUKw4m1deK6NGRLXhLI7DA/uQ6hGBgoMKJgwJACH5BAkKAAcALDcAJwA+AAsAAAN6eLrc/jBKQB0RmMCbd9aOUQxkYTgBpQbL1zUuZsUNadvnkqrrwdGtmCwoZIxuJQZv6RMKGM4nEahA3hbLbBTq5BYXVhs2y9tOXV7qIUwakyk/9PmTliuOyILyrfjWh39SYGwMO0ssfXQPcR4vDSI2IyiHEpWWl5UqDAkAIfkECQoABwAsNwAoAD0ACQAAA2B4R9KkEDIX42xVupdNGWBhKBtVldiJZqhQgTBsXKXVcuRtt9EXhzeXhjdcFWuQXyy4M+aIT+dBCWMeN01kVDulDmjYq2kbJo8Pvl9hITWz2mxul7rN1O00ezxV8cA+BwkAIfkEBQoABwAsNwAoAD0ACQAAA0x4R9KkEDIX42xVupfX1puQhVhFiiY5qldonZzSfqBaw7YMvyefe7jejaYTFn/B3ZCyLB1dzaAP+iQCkTvjckXdpqitzjX2dZbJU0UCADs="},"6be5":function(e,t,n){},"7a47":function(e,t,n){},"822d":function(e,t,n){"use strict";var r=n("6be5"),a=n.n(r);a.a},8701:function(e,t){"function"===typeof File&&(File.prototype.readAs=function(e){return new Promise(t=>{const n=new FileReader;n.onload=()=>t(n.result),n[`readAs${e}`](this)})})},"8d04":function(e,t,n){"use strict";n.r(t);var r=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{directives:[{name:"resize",rawName:"v-resize",value:e.onResize,expression:"onResize"}],staticClass:"spiral-piano",class:{"drag-hover":e.drageHover},on:{dragover:function(t){t.preventDefault(),e.drageHover=!0},dragleave:function(t){e.drageHover=!1},drop:function(t){return t.preventDefault(),e.onDropFiles(t)}}},[n("svg",{staticClass:"canvas",class:{"full-width":e.fullWidth,"full-height":!e.fullWidth},attrs:{viewBox:"-500 -500 1000 1000"}},[n("defs",[n("filter",{attrs:{id:"filter-brilliancy"}},[n("feColorMatrix",{attrs:{type:"saturate",values:"1.2"}})],1),n("filter",{attrs:{id:"filter-middle-saturate"}},[n("feColorMatrix",{attrs:{type:"saturate",values:"0.7"}})],1),n("filter",{attrs:{id:"filter-grey"}},[n("feColorMatrix",{attrs:{type:"saturate",values:"0.06"}})],1),n("filter",{attrs:{id:"filter-brightness-n4"}},[n("feComponentTransfer",[n("feFuncR",{attrs:{type:"linear",intercept:"-0.4",slope:"1"}}),n("feFuncG",{attrs:{type:"linear",intercept:"-0.4",slope:"1"}}),n("feFuncB",{attrs:{type:"linear",intercept:"-0.4",slope:"1"}})],1)],1),n("filter",{attrs:{id:"filter-brightness-n3"}},[n("feComponentTransfer",[n("feFuncR",{attrs:{type:"linear",intercept:"-0.3",slope:"1"}}),n("feFuncG",{attrs:{type:"linear",intercept:"-0.3",slope:"1"}}),n("feFuncB",{attrs:{type:"linear",intercept:"-0.3",slope:"1"}})],1)],1),n("filter",{attrs:{id:"filter-brightness-n2"}},[n("feComponentTransfer",[n("feFuncR",{attrs:{type:"linear",intercept:"-0.2",slope:"1"}}),n("feFuncG",{attrs:{type:"linear",intercept:"-0.2",slope:"1"}}),n("feFuncB",{attrs:{type:"linear",intercept:"-0.2",slope:"1"}})],1)],1),n("filter",{attrs:{id:"filter-brightness-n1"}},[n("feComponentTransfer",[n("feFuncR",{attrs:{type:"linear",intercept:"-0.1",slope:"1"}}),n("feFuncG",{attrs:{type:"linear",intercept:"-0.1",slope:"1"}}),n("feFuncB",{attrs:{type:"linear",intercept:"-0.1",slope:"1"}})],1)],1),n("filter",{attrs:{id:"filter-brightness-1"}},[n("feComponentTransfer",[n("feFuncR",{attrs:{type:"linear",intercept:"0.1",slope:"1"}}),n("feFuncG",{attrs:{type:"linear",intercept:"0.1",slope:"1"}}),n("feFuncB",{attrs:{type:"linear",intercept:"0.1",slope:"1"}})],1)],1),n("filter",{attrs:{id:"filter-brightness-2"}},[n("feComponentTransfer",[n("feFuncR",{attrs:{type:"linear",intercept:"0.2",slope:"1"}}),n("feFuncG",{attrs:{type:"linear",intercept:"0.2",slope:"1"}}),n("feFuncB",{attrs:{type:"linear",intercept:"0.2",slope:"1"}})],1)],1),n("filter",{attrs:{id:"filter-brightness-3"}},[n("feComponentTransfer",[n("feFuncR",{attrs:{type:"linear",intercept:"0.3",slope:"1"}}),n("feFuncG",{attrs:{type:"linear",intercept:"0.3",slope:"1"}}),n("feFuncB",{attrs:{type:"linear",intercept:"0.3",slope:"1"}})],1)],1),n("filter",{attrs:{id:"filter-brightness-4"}},[n("feComponentTransfer",[n("feFuncR",{attrs:{type:"linear",intercept:"0.4",slope:"1"}}),n("feFuncG",{attrs:{type:"linear",intercept:"0.4",slope:"1"}}),n("feFuncB",{attrs:{type:"linear",intercept:"0.4",slope:"1"}})],1)],1),n("filter",{attrs:{id:"filter-brightness-5"}},[n("feComponentTransfer",[n("feFuncR",{attrs:{type:"linear",intercept:"0.5",slope:"1"}}),n("feFuncG",{attrs:{type:"linear",intercept:"0.5",slope:"1"}}),n("feFuncB",{attrs:{type:"linear",intercept:"0.5",slope:"1"}})],1)],1)]),n("g",{staticClass:"regions"},e._l(e.regions,(function(t,r){return n("path",{key:r,staticClass:"region",class:{main:t.main,deputy:!t.main},attrs:{d:"M0,0 L"+t.point.x+","+t.point.y+" A"+e.Config.RegionRadius+","+e.Config.RegionRadius+" 0 0,0 "+e.regions[t.nextIndex].point.x+","+e.regions[t.nextIndex].point.y+" Z"}})})),0),n("g",{staticClass:"labels"}),n("g",{staticClass:"keys"},[n("g",{staticClass:"labels"},e._l(e.mode.SyllableNames,(function(t,r){return n("text",{directives:[{name:"show",rawName:"v-show",value:null!=t,expression:"name != null"}],key:r,staticClass:"syllable",attrs:{x:Math.cos(e.regions[r].angle)*(e.Config.InnerRadius-8),y:Math.sin(e.regions[r].angle)*(e.Config.InnerRadius-8)+3}},[e._v(" "+e._s(t)+" ")])})),0),n("g",{staticClass:"groups"},e._l(e.groups,(function(t,r){return n("g",{key:r,staticClass:"group",attrs:{"data-index":t.index}},e._l(t.keys,(function(t,r){return n("path",{key:r,staticClass:"key",class:{active:e.keyStatus[t.pitch].active},attrs:{"data-pitch":t.pitch,"data-step":t.step,d:t.path},on:{mousedown:function(n){return e.onKeyDown(t.pitch)},mouseup:function(n){return e.onKeyUp(t.pitch)}}})})),0)})),0)])]),n("div",{directives:[{name:"show",rawName:"v-show",value:e.showDashboard,expression:"showDashboard"}],staticClass:"dashboard"},[n("table",[n("tbody",[n("tr",[n("th"),n("td",[n("MidiDevices",{on:{midiInput:e.onMidiInputMessage}})],1)]),n("tr",[n("th",[e._v("Pitch Range")]),n("td",[n("input",{directives:[{name:"model",rawName:"v-model.number",value:e.wideRange.Start,expression:"wideRange.Start",modifiers:{number:!0}}],attrs:{type:"range",min:"21",max:e.wideRange.End-1},domProps:{value:e.wideRange.Start},on:{__r:function(t){e.$set(e.wideRange,"Start",e._n(t.target.value))},blur:function(t){return e.$forceUpdate()}}}),n("input",{directives:[{name:"model",rawName:"v-model.number",value:e.wideRange.End,expression:"wideRange.End",modifiers:{number:!0}}],attrs:{type:"range",min:e.wideRange.Start+1,max:"108"},domProps:{value:e.wideRange.End},on:{__r:function(t){e.$set(e.wideRange,"End",e._n(t.target.value))},blur:function(t){return e.$forceUpdate()}}}),n("span",[e._v("["+e._s(e.wideRange.Start)+" - "+e._s(e.wideRange.End)+"]")])])]),n("tr",[n("th",[e._v("Modal")]),n("td",[n("input",{directives:[{name:"model",rawName:"v-model.number",value:e.modalOffset,expression:"modalOffset",modifiers:{number:!0}}],attrs:{type:"range",min:"-7",max:7},domProps:{value:e.modalOffset},on:{__r:function(t){e.modalOffset=e._n(t.target.value)},blur:function(t){return e.$forceUpdate()}}}),e._v(" "+e._s(e.modalOffset)+" ")])]),e.midiFileName?n("tr",[n("th"),n("td",[n("button",{on:{click:e.onPlayFile}},[e._v(e._s(e.isPlaying?"‚è∏":"‚ñ∂"))]),n("span",[e._v(e._s(e.midiFileName))])])]):e._e()])])]),n("div",{directives:[{name:"show",rawName:"v-show",value:e.isPlaying&&!e.showDashboard,expression:"isPlaying && !showDashboard"}],staticClass:"tips"},[e._v(" F9 show controls. ")]),e.loading?n("Loading"):e._e()],1)},a=[],i=n("428d"),o=n.n(i),s={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",decodeArrayBuffer:function(e){var t=Math.ceil(3*e.length/4),n=new ArrayBuffer(t);return this.decode(e,n),n},decode:function(e,t){var n,r,a,i,o,s,u,l,c=this._keyStr.indexOf(e.charAt(e.length-1)),d=this._keyStr.indexOf(e.charAt(e.length-1)),f=Math.ceil(3*e.length/4);64===c&&f--,64===d&&f--;var p=0,h=0;for(n=t?new Uint8Array(t):new Uint8Array(f),e=e.replace(/[^A-Za-z0-9+/=]/g,""),p=0;p<f;p+=3)o=this._keyStr.indexOf(e.charAt(h++)),s=this._keyStr.indexOf(e.charAt(h++)),u=this._keyStr.indexOf(e.charAt(h++)),l=this._keyStr.indexOf(e.charAt(h++)),r=o<<2|s>>4,a=(15&s)<<4|u>>2,i=(3&u)<<6|l,n[p]=r,64!==u&&(n[p+1]=a),64!==l&&(n[p+2]=i);return n}},u=s;const l={};var c=function(e){l.api=e.api,l.setVolume=e.setVolume,l.programChange=e.programChange,l.noteOn=e.noteOn,l.noteOff=e.noteOff,l.chordOn=e.chordOn,l.chordOff=e.chordOff,l.stopAllNotes=e.stopAllNotes,l.getInput=e.getInput,l.getOutputs=e.getOutputs};(function(){var e=null,t=null,n=l.WebMIDI={api:"webmidi"};n.setVolume=function(e,n){t.send([176+e,7,n])},n.programChange=function(e,n){t.send([192+e,n])},n.noteOn=function(e,n,r,a){t.send([144+e,n,r],1e3*a)},n.noteOff=function(e,n,r){t.send([128+e,n,0],1e3*r)},n.chordOn=function(e,n,r,a){for(var i=0;i<n.length;i++){var o=n[i];t.send([144+e,o,r],1e3*a)}},n.chordOff=function(e,n,r){for(var a=0;a<n.length;a++){var i=n[a];t.send([128+e,i,0],1e3*r)}},n.stopAllNotes=function(){for(var e=0;e<16;e++)t.send([176+e,123,0])},n.getInput=function(){return e.getInputs()},n.getOutputs=function(){return e.getOutputs()},n.connect=function(r){c(n),navigator.requestMIDIAccess().then((function(n){e=n;const a=[...e.outputs];t=a[r.outputDeviceIndex||0][1],r.callback&&r.callback()}),(function(){window.AudioContext||window.webkitAudioContext?r.api="webaudio":window.Audio?r.api="audiotag":r.api="flash",l.loadPlugin(r)}))}})(),(window.AudioContext||window.webkitAudioContext)&&function(){var e,t=l.WebAudio={api:"webaudio"},n={},r=127,a={},i=function(t,n,r,i,o){var s=l.GeneralMIDI.byName[t],c=s.number,d=n[r];if(!l.Soundfont[t][d])return o(t);var f=l.Soundfont[t][d].split(",")[1],p=u.decodeArrayBuffer(f);e.decodeAudioData(p,(function(e){var u=d;while(u.length<3)u+="&nbsp;";if("undefined"!==typeof l.loader&&l.loader.update(null,s.instrument+"<br>Processing: "+(r/87*100>>0)+"%<br>"+u),e.id=d,i[r]=e,i.length===n.length){while(i.length)if(e=i.pop(),e){var f=l.keyToNote[e.id];a[c+""+f]=e}o(t)}}))};t.setVolume=function(e,t){r=t},t.programChange=function(e,t){l.channels[e].instrument=t},t.noteOn=function(t,i,o,s){if(l.channels[t]){var u=l.channels[t].instrument;if(a[u+""+i]){s<e.currentTime&&(s+=e.currentTime);var c=e.createBufferSource();n[t+""+i]=c,c.buffer=a[u+""+i],c.connect(e.destination),e.createGain?c.gainNode=e.createGain():c.gainNode=e.createGainNode();var d=o/127*(r/127)*2-1;return c.gainNode.connect(e.destination),c.gainNode.gain.setTargetAtTime(Math.max(-1,d),e.currentTime,0),c.connect(c.gainNode),c.noteOn?c.noteOn(s||0):c.start(s||0),c}}},t.noteOff=function(t,r,a){a=a||0,a<e.currentTime&&(a+=e.currentTime);var i=n[t+""+r];if(i){if(i.gainNode){var o=i.gainNode.gain;o.linearRampToValueAtTime(o.value,a),o.linearRampToValueAtTime(-1,a+.2)}i.noteOff?i.noteOff(a+.3):i.stop(a+.3),delete n[t+""+r]}},t.chordOn=function(e,n,r,a){for(var i,o={},s=0,u=n.length;s<u;s++)o[i=n[s]]=t.noteOn(e,i,r,a);return o},t.chordOff=function(e,n,r){for(var a,i={},o=0,s=n.length;o<s;o++)i[a=n[o]]=t.noteOff(e,a,r);return i},t.stopAllNotes=function(){for(var t in n){var r=0;r<e.currentTime&&(r+=e.currentTime),n[t].gainNode.gain.linearRampToValueAtTime(1,r),n[t].gainNode.gain.linearRampToValueAtTime(0,r+.2),delete n[t]}},t.connect=function(n){c(t),e=new AudioContext;var r=[],a=l.keyToNote;for(var o in a)r.push(o);var s=[],u={},d=function(e){for(var t in delete u[e],u)break;!t&&n.callback&&n.callback()};for(var f in l.Soundfont){u[f]=!0;for(var p=0;p<r.length;p++)i(f,r,p,s,d)}}}(),window.Audio&&function(){for(var e=l.AudioTag={api:"audiotag"},t={},n=127,r=-1,a=[],i=[],o={},s=0;s<12;s++)a[s]=new Audio;var u=function(e,t){if(l.channels[e]){var s=l.channels[e].instrument,u=l.GeneralMIDI.byId[s].id,c=o[t];if(c){var d=u+""+c.id,f=(r+1)%a.length,p=a[f];i[f]=d,p.src=l.Soundfont[u][c.id],p.volume=n/127,p.play(),r=f}}},d=function(e,t){if(l.channels[e]){var n=l.channels[e].instrument,s=l.GeneralMIDI.byId[n].id,u=o[t];if(u)for(var c=s+""+u.id,d=0;d<a.length;d++){var f=(d+r+1)%a.length,p=i[f];if(p&&p===c)return a[f].pause(),void(i[f]=null)}}};e.programChange=function(e,t){l.channels[e].instrument=t},e.setVolume=function(e,t){n=t},e.noteOn=function(e,n,r,a){var i=t[n];if(o[i])return a?window.setTimeout((function(){u(e,i)}),1e3*a):void u(e,i)},e.noteOff=function(e,n,r){var a=t[n];if(o[a])return r?setTimeout((function(){d(e,a)}),1e3*r):void d(e,a)},e.chordOn=function(e,n,r,a){for(var i=0;i<n.length;i++){var s=n[i],l=t[s];if(o[l]){if(a)return window.setTimeout((function(){u(e,l)}),1e3*a);u(e,l)}}},e.chordOff=function(e,n,r){for(var a=0;a<n.length;a++){var i=n[a],s=t[i];if(o[s]){if(r)return window.setTimeout((function(){d(e,s)}),1e3*r);d(e,s)}}},e.stopAllNotes=function(){for(var e=0,t=a.length;e<t;e++)a[e].pause()},e.connect=function(n){for(var r in console.log("AudioTag.connect:",n),l.keyToNote)t[l.keyToNote[r]]=r,o[r]={id:r};c(e),n.callback&&n.callback()}}(),l.GeneralMIDI=function(e){var t=function(e){return e.replace(/[^a-z0-9 ]/gi,"").replace(/[ ]/g,"_").toLowerCase()},n={byName:{},byId:{},byCategory:{}};for(var r in e)for(var a=e[r],i=0,o=a.length;i<o;i++){var s=a[i];if(s){var u=parseInt(s.substr(0,s.indexOf(" ")),10);s=s.replace(u+" ",""),n.byId[--u]=n.byName[t(s)]=n.byCategory[t(r)]={id:t(s),instrument:s,number:u,category:r}}}return n}({Piano:["1 Acoustic Grand Piano","2 Bright Acoustic Piano","3 Electric Grand Piano","4 Honky-tonk Piano","5 Electric Piano 1","6 Electric Piano 2","7 Harpsichord","8 Clavinet"],"Chromatic Percussion":["9 Celesta","10 Glockenspiel","11 Music Box","12 Vibraphone","13 Marimba","14 Xylophone","15 Tubular Bells","16 Dulcimer"],Organ:["17 Drawbar Organ","18 Percussive Organ","19 Rock Organ","20 Church Organ","21 Reed Organ","22 Accordion","23 Harmonica","24 Tango Accordion"],Guitar:["25 Acoustic Guitar (nylon)","26 Acoustic Guitar (steel)","27 Electric Guitar (jazz)","28 Electric Guitar (clean)","29 Electric Guitar (muted)","30 Overdriven Guitar","31 Distortion Guitar","32 Guitar Harmonics"],Bass:["33 Acoustic Bass","34 Electric Bass (finger)","35 Electric Bass (pick)","36 Fretless Bass","37 Slap Bass 1","38 Slap Bass 2","39 Synth Bass 1","40 Synth Bass 2"],Strings:["41 Violin","42 Viola","43 Cello","44 Contrabass","45 Tremolo Strings","46 Pizzicato Strings","47 Orchestral Harp","48 Timpani"],Ensemble:["49 String Ensemble 1","50 String Ensemble 2","51 Synth Strings 1","52 Synth Strings 2","53 Choir Aahs","54 Voice Oohs","55 Synth Choir","56 Orchestra Hit"],Brass:["57 Trumpet","58 Trombone","59 Tuba","60 Muted Trumpet","61 French Horn","62 Brass Section","63 Synth Brass 1","64 Synth Brass 2"],Reed:["65 Soprano Sax","66 Alto Sax","67 Tenor Sax","68 Baritone Sax","69 Oboe","70 English Horn","71 Bassoon","72 Clarinet"],Pipe:["73 Piccolo","74 Flute","75 Recorder","76 Pan Flute","77 Blown Bottle","78 Shakuhachi","79 Whistle","80 Ocarina"],"Synth Lead":["81 Lead 1 (square)","82 Lead 2 (sawtooth)","83 Lead 3 (calliope)","84 Lead 4 (chiff)","85 Lead 5 (charang)","86 Lead 6 (voice)","87 Lead 7 (fifths)","88 Lead 8 (bass + lead)"],"Synth Pad":["89 Pad 1 (new age)","90 Pad 2 (warm)","91 Pad 3 (polysynth)","92 Pad 4 (choir)","93 Pad 5 (bowed)","94 Pad 6 (metallic)","95 Pad 7 (halo)","96 Pad 8 (sweep)"],"Synth Effects":["97 FX 1 (rain)","98 FX 2 (soundtrack)","99 FX 3 (crystal)","100 FX 4 (atmosphere)","101 FX 5 (brightness)","102 FX 6 (goblins)","103 FX 7 (echoes)","104 FX 8 (sci-fi)"],Ethnic:["105 Sitar","106 Banjo","107 Shamisen","108 Koto","109 Kalimba","110 Bagpipe","111 Fiddle","112 Shanai"],Percussive:["113 Tinkle Bell","114 Agogo","115 Steel Drums","116 Woodblock","117 Taiko Drum","118 Melodic Tom","119 Synth Drum"],"Sound effects":["120 Reverse Cymbal","121 Guitar Fret Noise","122 Breath Noise","123 Seashore","124 Bird Tweet","125 Telephone Ring","126 Helicopter","127 Applause","128 Gunshot"]}),l.channels=function(){for(var e={},t=0;t<16;t++)e[t]={instrument:0,mute:!1,mono:!1,omni:!1,solo:!1};return e}(),l.pianoKeyOffset=21,l.keyToNote={},l.noteToKey={},function(){for(var e=21,t=108,n=["C","Db","D","Eb","E","F","Gb","G","Ab","A","Bb","B"],r=e;r<=t;r++){var a=(r-12)/12>>0,i=n[r%12]+a;l.keyToNote[i]=r,l.noteToKey[r]=i}}();var d=l,f={},p=0,h=function(e){p++;var t=new Audio,n=e.split(";")[0];t.id="audio",t.setAttribute("preload","auto"),t.setAttribute("audiobuffer",!0),t.addEventListener("error",(function(){f[n]=!1,p--}),!1),t.addEventListener("canplaythrough",(function(){f[n]=!0,p--}),!1),t.src="data:"+e,document.body.appendChild(t)};function A(e){if("undefined"===typeof Audio)return e({});var t=new Audio;if("undefined"===typeof t.canPlayType)return e(f);var n=t.canPlayType('audio/ogg; codecs="vorbis"');n="probably"===n||"maybe"===n;var r=t.canPlayType("audio/mpeg");if(r="probably"===r||"maybe"===r,n||r){n&&h("audio/ogg;base64,T2dnUwACAAAAAAAAAADqnjMlAAAAAOyyzPIBHgF2b3JiaXMAAAAAAUAfAABAHwAAQB8AAEAfAACZAU9nZ1MAAAAAAAAAAAAA6p4zJQEAAAANJGeqCj3//////////5ADdm9yYmlzLQAAAFhpcGguT3JnIGxpYlZvcmJpcyBJIDIwMTAxMTAxIChTY2hhdWZlbnVnZ2V0KQAAAAABBXZvcmJpcw9CQ1YBAAABAAxSFCElGVNKYwiVUlIpBR1jUFtHHWPUOUYhZBBTiEkZpXtPKpVYSsgRUlgpRR1TTFNJlVKWKUUdYxRTSCFT1jFloXMUS4ZJCSVsTa50FkvomWOWMUYdY85aSp1j1jFFHWNSUkmhcxg6ZiVkFDpGxehifDA6laJCKL7H3lLpLYWKW4q91xpT6y2EGEtpwQhhc+211dxKasUYY4wxxsXiUyiC0JBVAAABAABABAFCQ1YBAAoAAMJQDEVRgNCQVQBABgCAABRFcRTHcRxHkiTLAkJDVgEAQAAAAgAAKI7hKJIjSZJkWZZlWZameZaouaov+64u667t6roOhIasBACAAAAYRqF1TCqDEEPKQ4QUY9AzoxBDDEzGHGNONKQMMogzxZAyiFssLqgQBKEhKwKAKAAAwBjEGGIMOeekZFIi55iUTkoDnaPUUcoolRRLjBmlEluJMYLOUeooZZRCjKXFjFKJscRUAABAgAMAQICFUGjIigAgCgCAMAYphZRCjCnmFHOIMeUcgwwxxiBkzinoGJNOSuWck85JiRhjzjEHlXNOSuekctBJyaQTAAAQ4AAAEGAhFBqyIgCIEwAwSJKmWZomipamiaJniqrqiaKqWp5nmp5pqqpnmqpqqqrrmqrqypbnmaZnmqrqmaaqiqbquqaquq6nqrZsuqoum65q267s+rZru77uqapsm6or66bqyrrqyrbuurbtS56nqqKquq5nqq6ruq5uq65r25pqyq6purJtuq4tu7Js664s67pmqq5suqotm64s667s2rYqy7ovuq5uq7Ks+6os+75s67ru2rrwi65r66os674qy74x27bwy7ouHJMnqqqnqq7rmarrqq5r26rr2rqmmq5suq4tm6or26os67Yry7aumaosm64r26bryrIqy77vyrJui67r66Ys67oqy8Lu6roxzLat+6Lr6roqy7qvyrKuu7ru+7JuC7umqrpuyrKvm7Ks+7auC8us27oxuq7vq7It/KosC7+u+8Iy6z5jdF1fV21ZGFbZ9n3d95Vj1nVhWW1b+V1bZ7y+bgy7bvzKrQvLstq2scy6rSyvrxvDLux8W/iVmqratum6um7Ksq/Lui60dd1XRtf1fdW2fV+VZd+3hV9pG8OwjK6r+6os68Jry8ov67qw7MIvLKttK7+r68ow27qw3L6wLL/uC8uq277v6rrStXVluX2fsSu38QsAABhwAAAIMKEMFBqyIgCIEwBAEHIOKQahYgpCCKGkEEIqFWNSMuakZM5JKaWUFEpJrWJMSuaclMwxKaGUlkopqYRSWiqlxBRKaS2l1mJKqcVQSmulpNZKSa2llGJMrcUYMSYlc05K5pyUklJrJZXWMucoZQ5K6iCklEoqraTUYuacpA46Kx2E1EoqMZWUYgupxFZKaq2kFGMrMdXUWo4hpRhLSrGVlFptMdXWWqs1YkxK5pyUzDkqJaXWSiqtZc5J6iC01DkoqaTUYiopxco5SR2ElDLIqJSUWiupxBJSia20FGMpqcXUYq4pxRZDSS2WlFosqcTWYoy1tVRTJ6XFklKMJZUYW6y5ttZqDKXEVkqLsaSUW2sx1xZjjqGkFksrsZWUWmy15dhayzW1VGNKrdYWY40x5ZRrrT2n1mJNMdXaWqy51ZZbzLXnTkprpZQWS0oxttZijTHmHEppraQUWykpxtZara3FXEMpsZXSWiypxNhirLXFVmNqrcYWW62ltVprrb3GVlsurdXcYqw9tZRrrLXmWFNtBQAADDgAAASYUAYKDVkJAEQBAADGMMYYhEYpx5yT0ijlnHNSKucghJBS5hyEEFLKnINQSkuZcxBKSSmUklJqrYVSUmqttQIAAAocAAACbNCUWByg0JCVAEAqAIDBcTRNFFXVdX1fsSxRVFXXlW3jVyxNFFVVdm1b+DVRVFXXtW3bFn5NFFVVdmXZtoWiqrqybduybgvDqKqua9uybeuorqvbuq3bui9UXVmWbVu3dR3XtnXd9nVd+Bmzbeu2buu+8CMMR9/4IeTj+3RCCAAAT3AAACqwYXWEk6KxwEJDVgIAGQAAgDFKGYUYM0gxphhjTDHGmAAAgAEHAIAAE8pAoSErAoAoAADAOeecc84555xzzjnnnHPOOeecc44xxhhjjDHGGGOMMcYYY4wxxhhjjDHGGGOMMcYYY0wAwE6EA8BOhIVQaMhKACAcAABACCEpKaWUUkoRU85BSSmllFKqFIOMSkoppZRSpBR1lFJKKaWUIqWgpJJSSimllElJKaWUUkoppYw6SimllFJKKaWUUkoppZRSSimllFJKKaWUUkoppZRSSimllFJKKaWUUkoppZRSSimllFJKKaWUUkoppZRSSimllFJKKaVUSimllFJKKaWUUkoppRQAYPLgAACVYOMMK0lnhaPBhYasBAByAwAAhRiDEEJpraRUUkolVc5BKCWUlEpKKZWUUqqYgxBKKqmlklJKKbXSQSihlFBKKSWUUkooJYQQSgmhlFRCK6mEUkoHoYQSQimhhFRKKSWUzkEoIYUOQkmllNRCSB10VFIpIZVSSiklpZQ6CKGUklJLLZVSWkqpdBJSKamV1FJqqbWSUgmhpFZKSSWl0lpJJbUSSkklpZRSSymFVFJJJYSSUioltZZaSqm11lJIqZWUUkqppdRSSiWlkEpKqZSSUmollZRSaiGVlEpJKaTUSimlpFRCSamlUlpKLbWUSkmptFRSSaWUlEpJKaVSSksppRJKSqmllFpJKYWSUkoplZJSSyW1VEoKJaWUUkmptJRSSymVklIBAEAHDgAAAUZUWoidZlx5BI4oZJiAAgAAQABAgAkgMEBQMApBgDACAQAAAADAAAAfAABHARAR0ZzBAUKCwgJDg8MDAAAAAAAAAAAAAACAT2dnUwAEAAAAAAAAAADqnjMlAgAAADzQPmcBAQA="),r&&h("audio/mpeg;base64,/+MYxAAAAANIAUAAAASEEB/jwOFM/0MM/90b/+RhST//w4NFwOjf///PZu////9lns5GFDv//l9GlUIEEIAAAgIg8Ir/JGq3/+MYxDsLIj5QMYcoAP0dv9HIjUcH//yYSg+CIbkGP//8w0bLVjUP///3Z0x5QCAv/yLjwtGKTEFNRTMuOTeqqqqqqqqqqqqq/+MYxEkNmdJkUYc4AKqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq");var a=(new Date).getTime(),i=window.setInterval((function(){var t=(new Date).getTime(),n=t-a>5e3;p&&!n||(window.clearInterval(i),e(f))}),1)}else e(f)}const m={};(function(){m.script=function(){return this.loaded={},this.loading={},this},m.script.prototype.add=function(e){var t=this;"string"===typeof e&&(e={src:e});var n=e.srcs;"undefined"===typeof n&&(n=[{src:e.src,verify:e.verify}]);var r=document.getElementsByTagName("head")[0],a=function(e,n){t.loaded[e.src]||n&&"undefined"===typeof window[n]||(t.loaded[e.src]=!0,t.loading[e.src]&&t.loading[e.src](),delete t.loading[e.src],e.callback&&e.callback(),"undefined"!==typeof u&&u())},i=[],o=function(n){if("string"===typeof n&&(n={src:n,verify:e.verify}),/([\w\d.])$/.test(n.verify))if(n.test=n.verify,"object"===typeof n.test)for(var o in n.test)i.push(n.test[o]);else i.push(n.test);if(!t.loaded[n.src]){var s=document.createElement("script");s.onreadystatechange=function(){"loaded"!==this.readyState&&"complete"!==this.readyState||a(n)},s.onload=function(){a(n)},s.onerror=function(){},s.setAttribute("type","text/javascript"),s.setAttribute("src",n.src),r.appendChild(s),t.loading[n.src]=function(){}}},s=function(t){if(t)a(t,t.test);else for(let e=0;e<n.length;e++)a(n[e],n[e].test);var r=!0;for(let e=0;e<i.length;e++){var o=i[e];if(o&&-1!==o.indexOf(".")){o=o.split(".");var u=window[o[0]];if("undefined"===typeof u)continue;2===o.length?"undefined"===typeof u[o[1]]&&(r=!1):3===o.length&&"undefined"===typeof u[o[1]][o[2]]&&(r=!1)}else"undefined"===typeof window[o]&&(r=!1)}!e.strictOrder&&r?e.callback&&e.callback():setTimeout((function(){s(t)}),10)};if(e.strictOrder){let r=-1;var u=function(){if(r++,n[r]){var a=n[r],i=a.src;t.loading[i]?t.loading[i]=function(){a.callback&&a.callback(),u()}:t.loaded[i]?u():(o(a),s(a))}else e.callback&&e.callback()};u()}else{for(let e=0;e<n.length;e++)o(n[e]);s()}},m.script=new m.script})();var g=m.script;function y(e){fetch(e.url,e.data).then(e=>e.text()).then(t=>{e.onload&&e.onload({responseText:t})}).catch(t=>{console.warn("DOMLoader.sendRequest error:",t),e.onerror&&e.onerror(event,!1)})}const v={script:g,sendRequest:y};window.MIDI=d,d.Soundfont={},d.audioDetect=A;const w=!1;d.loadPlugin=function(e={}){"function"===typeof e&&(e={callback:e});var t=e.instruments||e.instrument||"acoustic_grand_piano";"object"!==typeof t&&(t=[t]);for(var n=0;n<t.length;n++){var r=t[n];"number"===typeof r&&(t[n]=d.GeneralMIDI.byId[r])}if(d.soundfontUrl=e.soundfontUrl||d.soundfontUrl||"./soundfont/",d.audioDetect((function(n){var r="";if(r=q[e.api]?e.api:w&&navigator.requestMIDIAccess?"webmidi":window.webkitAudioContext||window.AudioContext?"webaudio":window.Audio?"audiotag":"flash",!b[r])return;let a;a=e.targetFormat?e.targetFormat:n["audio/ogg"]?"ogg":"mp3",d.lang=r,d.supports=n,b[r](a,t,e)})),!e.callback)return new Promise(t=>e.callback=t)};var b={webmidi:function(e,t,n){d.loader&&d.loader.message("Web MIDI API..."),d.WebMIDI.connect(n)},flash:function(e,t,n){d.loader&&d.loader.message("Flash API..."),v.script.add({src:n.soundManagerUrl||"./inc/SoundManager2/script/soundmanager2.js",verify:"SoundManager",callback:function(){d.Flash.connect(t,n)}})},audiotag:function(e,t,n){d.loader&&d.loader.message("HTML5 Audio API...");var r=S({items:t,getNext:function(t){v.sendRequest({url:d.soundfontUrl+t+"-"+e+".js",onprogress:I,onload:function(e){k(e.responseText),d.loader&&d.loader.update(null,"Downloading",100),r.getNext()}})},onComplete:function(){d.AudioTag.connect(n)}})},webaudio:function(e,t,n){d.loader&&d.loader.message("Web Audio API...");var r=S({items:t,getNext:function(t){v.sendRequest({url:d.soundfontUrl+t+"-"+e+".js",onprogress:I,onload:function(e){k(e.responseText),d.loader&&d.loader.update(null,"Downloading...",100),r.getNext()}})},onComplete:function(){d.WebAudio.connect(n)}})}},q={webmidi:!0,webaudio:!0,audiotag:!0,flash:!0},k=function(e){var t=document.createElement("script");t.language="javascript",t.type="text/javascript",t.text=e,document.body.appendChild(t)},I=function(e){this.totalSize||(this.getResponseHeader("Content-Length-Raw")?this.totalSize=parseInt(this.getResponseHeader("Content-Length-Raw")):this.totalSize=e.total);var t=this.totalSize?Math.round(e.loaded/this.totalSize*100):"";d.loader&&d.loader.update(null,"Downloading...",t)},S=function(e){var t={queue:[]};for(var n in e.items)e.items.hasOwnProperty(n)&&t.queue.push(e.items[n]);return t.getNext=function(){if(!t.queue.length)return e.onComplete();e.getNext(t.queue.shift())},setTimeout(t.getNext,1),t};d.loadPlugin;function x(e){var t=0;function n(n){var r=e.substr(t,n);return t+=n,r}function r(){var n=(e.charCodeAt(t)<<24)+(e.charCodeAt(t+1)<<16)+(e.charCodeAt(t+2)<<8)+e.charCodeAt(t+3);return t+=4,n}function a(){var n=(e.charCodeAt(t)<<8)+e.charCodeAt(t+1);return t+=2,n}function i(n){var r=e.charCodeAt(t);return n&&r>127&&(r-=256),t+=1,r}function o(){return t>=e.length}function s(){var e=0;while(1){var t=i();if(!(128&t))return e+t;e+=127&t,e<<=7}}return{eof:o,read:n,readInt32:r,readInt16:a,readInt8:i,readVarInt:s}}function C(e){function t(e){var t=e.read(4),n=e.readInt32();return{id:t,length:n,data:e.read(n)}}var n;function r(e){var t={};t.deltaTime=e.readVarInt();var r=e.readInt8();if(240===(240&r)){if(255!==r){if(240===r){t.type="sysEx";const n=e.readVarInt();return t.data=e.read(n),t}if(247===r){t.type="dividedSysEx";const n=e.readVarInt();return t.data=e.read(n),t}throw new Error("Unrecognised MIDI event type byte: "+r)}t.type="meta";var a=e.readInt8(),i=e.readVarInt();switch(a){case 0:if(t.subtype="sequenceNumber",2!==i)throw new Error("Expected length for sequenceNumber event is 2, got "+i);return t.number=e.readInt16(),t;case 1:return t.subtype="text",t.text=e.read(i),t;case 2:return t.subtype="copyrightNotice",t.text=e.read(i),t;case 3:return t.subtype="trackName",t.text=e.read(i),t;case 4:return t.subtype="instrumentName",t.text=e.read(i),t;case 5:return t.subtype="lyrics",t.text=e.read(i),t;case 6:return t.subtype="marker",t.text=e.read(i),t;case 7:return t.subtype="cuePoint",t.text=e.read(i),t;case 32:if(t.subtype="midiChannelPrefix",1!==i)throw new Error("Expected length for midiChannelPrefix event is 1, got "+i);return t.channel=e.readInt8(),t;case 47:if(t.subtype="endOfTrack",0!==i)throw new Error("Expected length for endOfTrack event is 0, got "+i);return t;case 81:if(t.subtype="setTempo",3!==i)throw new Error("Expected length for setTempo event is 3, got "+i);return t.microsecondsPerBeat=(e.readInt8()<<16)+(e.readInt8()<<8)+e.readInt8(),t;case 84:if(t.subtype="smpteOffset",5!==i)throw new Error("Expected length for smpteOffset event is 5, got "+i);var o=e.readInt8();return t.frameRate={0:24,32:25,64:29,96:30}[96&o],t.hour=31&o,t.min=e.readInt8(),t.sec=e.readInt8(),t.frame=e.readInt8(),t.subframe=e.readInt8(),t;case 88:if(t.subtype="timeSignature",4!==i)throw new Error("Expected length for timeSignature event is 4, got "+i);return t.numerator=e.readInt8(),t.denominator=Math.pow(2,e.readInt8()),t.metronome=e.readInt8(),t.thirtyseconds=e.readInt8(),t;case 89:if(t.subtype="keySignature",2!==i)throw new Error("Expected length for keySignature event is 2, got "+i);return t.key=e.readInt8(!0),t.scale=e.readInt8(),t;case 127:return t.subtype="sequencerSpecific",t.data=e.read(i),t;default:return t.subtype="unknown",t.data=e.read(i),t}}else{var s;0===(128&r)?(s=r,r=n):(s=e.readInt8(),n=r);var u=r>>4;switch(t.channel=15&r,t.type="channel",u){case 8:return t.subtype="noteOff",t.noteNumber=s,t.velocity=e.readInt8(),t;case 9:return t.noteNumber=s,t.velocity=e.readInt8(),0===t.velocity?t.subtype="noteOff":t.subtype="noteOn",t;case 10:return t.subtype="noteAftertouch",t.noteNumber=s,t.amount=e.readInt8(),t;case 11:return t.subtype="controller",t.controllerType=s,t.value=e.readInt8(),t;case 12:return t.subtype="programChange",t.programNumber=s,t;case 13:return t.subtype="channelAftertouch",t.amount=s,t;case 14:return t.subtype="pitchBend",t.value=s+(e.readInt8()<<7),t;default:throw new Error("Unrecognised MIDI event type: "+u)}}}const a=x(e);var i=t(a);if("MThd"!==i.id||6!==i.length)throw new Error("Bad .mid file - header not found");var o=x(i.data),s=o.readInt16(),u=o.readInt16(),l=o.readInt16();let c;if(32768&l)throw new Error("Expressing time division in SMTPE frames is not supported yet");c=l;for(var d={formatType:s,trackCount:u,ticksPerBeat:c},f=[],p=0;p<d.trackCount;p++){f[p]=[];var h=t(a);if("MTrk"!==h.id)throw new Error("Unexpected chunk - expected MTrk, got "+h.id);var A=x(h.data);while(!A.eof()){var m=r(A);f[p].push(m)}}return{header:d,tracks:f}}var T=function(e){if("object"!==typeof e)return e;if(null===e)return e;var t="number"===typeof e.length?[]:{};for(var n in e)t[n]=T(e[n]);return t};function M(e,t){for(var n,r=[],a=120,i=e.header.ticksPerBeat,o=0;o<e.tracks.length;o++)r[o]={nextEventIndex:0,ticksToNextEvent:e.tracks[o].length?e.tracks[o][0].deltaTime:null};function s(){var t=null,n=null,a=null;for(let e=0;e<r.length;e++)null!==r[e].ticksToNextEvent&&(null===t||r[e].ticksToNextEvent<t)&&(t=r[e].ticksToNextEvent,n=e,a=r[e].nextEventIndex);if(null!==n){var i=e.tracks[n][a];e.tracks[n][a+1]?r[n].ticksToNextEvent+=e.tracks[n][a+1].deltaTime:r[n].ticksToNextEvent=null,r[n].nextEventIndex+=1;for(let e=0;e<r.length;e++)null!==r[e].ticksToNextEvent&&(r[e].ticksToNextEvent-=t);return{ticksToEvent:t,event:i,track:n}}return null}var u=[];function l(){function e(){if("meta"===n.event.type&&"setTempo"===n.event.subtype&&(a=6e7/n.event.microsecondsPerBeat),n.ticksToEvent>0)var e=n.ticksToEvent/i,r=e/(a/60);var o=1e3*r*t||0;u.push([n,o]),n=s()}if(n=s(),n)while(n)e(!0)}return l(),{getData:function(){return T(u)},ticksPerBeat:i}}const R={};(function(){var e=R;e.callback=void 0,e.currentTime=0,e.endTime=0,e.restart=0,e.playing=!1,e.timeWarp=1,e.start=e.resume=function(){e.currentTime<-1&&(e.currentTime=-1),c(e.currentTime)},e.pause=function(){var t=e.restart;f(),e.restart=t},e.stop=function(){f(),e.restart=0,e.currentTime=0},e.addListener=function(e){n=e},e.removeListener=function(){n=void 0},e.clearAnimation=function(){e.interval&&window.clearInterval(e.interval)},e.setAnimation=function(t){var n="function"===typeof t?t:t.callback,r=t.interval||30,a=0,o=0,s=0;e.clearAnimation(),e.interval=window.setInterval((function(){if(0!==e.endTime){e.playing?(a=s===e.currentTime?o-(new Date).getTime():0,a=0===e.currentTime?0:e.currentTime-a,s!==e.currentTime&&(o=(new Date).getTime(),s=e.currentTime)):a=e.currentTime;var t=e.endTime,r=a/1e3,u=r/60,l=r-60*u,c=60*u+l,d=t/1e3;d-c<-1||n({now:c,end:d,events:i})}}),r)},e.loadMidiFile=function(){e.file=C(e.currentData),e.replayer=M(e.file,e.timeWarp),e.data=e.replayer.getData(),e.endTime=l()},e.loadFile=function(t,n){if(e.stop(),-1!==t.indexOf("base64,")){var r=window.atob(t.split(",")[1]);return e.currentData=r,e.loadMidiFile(),n?void n(e.data):Promise.resolve(e.data)}let a;n||(a=new Promise(e=>n=e));var i=new XMLHttpRequest;return i.open("GET",t),i.overrideMimeType("text/plain; charset=x-user-defined"),i.onreadystatechange=function(){if(4===this.readyState&&200===this.status){for(var t=this.responseText||"",r=[],a=t.length,i=String.fromCharCode,o=0;o<a;o++)r[o]=i(255&t.charCodeAt(o));var s=r.join("");e.currentData=s,e.loadMidiFile(),n&&n(e.data)}},i.send(),a};var t,n,r=[],a=0,i={},o=function(r,a,o,s,u,l){var d=window.setTimeout((function(){var s={channel:r,note:a,now:o,end:e.endTime,message:u,velocity:l};128===u?delete i[a]:i[a]=s,n&&n(s),e.currentTime=o,e.currentTime===t&&t<e.endTime&&c(t,!0)}),o-s);return d},s=function(e,t,r){var a=window.setTimeout((function(){if(n){var e={message:r.type};for(var t in r)e[t]=r[t];n(e)}}),e-t);return a},u=function(){return"WebAudioAPI"===d.lang?R.ctx:(e.ctx||(e.ctx={currentTime:0}),e.ctx)},l=function(){for(var t=e.data,n=t.length,r=.5,a=0;a<n;a++)r+=t[a][1];return r},c=function(n,i){if(e.replayer){var c;i||("undefined"===typeof n&&(n=e.restart),e.playing&&f(),e.playing=!0,e.data=e.replayer.getData(),e.endTime=l());var p=0,h=0,A=e.data,m=u(),g=A.length;t=.5,a=m.currentTime;for(var y=0;y<g&&h<100;y++)if(t+=A[y][1],t<n)p=t;else{n=t-p;var v=A[y][0].event;if("channel"===v.type){var w=v.channel;switch(v.subtype){case"noteOn":if(d.channels[w].mute)break;c=v.noteNumber-(e.MIDIOffset||0),r.push({event:v,source:d.noteOn(w,v.noteNumber,v.velocity,n/1e3+m.currentTime),interval:o(w,c,t,p,144,v.velocity)}),h++;break;case"noteOff":if(d.channels[w].mute)break;c=v.noteNumber-(e.MIDIOffset||0),r.push({event:v,source:d.noteOff(w,v.noteNumber,n/1e3+m.currentTime),interval:o(w,c,t,p,128)});break;default:break}}else r.push({event:v,interval:s(t,p,v)})}}},f=function(){var t=u();e.playing=!1,e.restart+=1e3*(t.currentTime-a);while(r.length){const e=r.pop();window.clearInterval(e.interval),e.source&&("number"===typeof e.source?window.clearTimeout(e.source):e.source.disconnect(0))}for(var o in i){const e=i[o];144===i[o].message&&n&&n({channel:e.channel,note:e.note,now:e.now,end:e.end,message:128,velocity:e.velocity})}i={}}})();var E=R;d.Player=E;var K=d,B=(n("8701"),function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"midi-devices"},[e.navigatorSupported?n("div",[n("select",{ref:"inputList",staticClass:"input-list",attrs:{title:"Choose a MIDI Input Device",disabled:e.loading||0==e.inputDevices.length},on:{change:e.updateInputConnection}},[e._l(e.inputDevices,(function(t){return n("option",{key:t.id,domProps:{value:t.id,selected:t.id===e.value}},[e._v(" "+e._s(t.name)+" ")])})),0==e.inputDevices.length?n("option",[e._v(" No Connection ")]):e._e()],2),n("button",{staticClass:"refresh",on:{click:e.refreshInputList}},[e._v("üîÑ")])]):e._e(),e.navigatorSupported?e._e():n("div",{staticClass:"unsupported"},[e._v(" The browser does not supported "),n("a",{attrs:{href:"https://www.w3.org/TR/webmidi/",target:"_blank"}},[e._v("WebMIDI APIs")]),e._v(". ")])])}),F=[],D={name:"midi-devices",props:{value:String},mounted(){navigator.requestMIDIAccess&&(this.loading=!0,navigator.requestMIDIAccess().then(e=>{this.MidiAccess=e,this.refreshInputList()}))},beforeDestroyed(){if(this.MidiAccess){const e=this.MidiAccess.inputs.values();for(const t of e)t.onmidimessage=null}},data(){return{inputDevices:[],loading:!1}},computed:{navigatorSupported(){return navigator.requestMIDIAccess}},methods:{refreshInputList(){this.MidiAccess&&(this.loading=!0,this.inputDevices=[...this.MidiAccess.inputs.values()],this.$nextTick(()=>this.updateInputConnection()))},updateInputConnection(){if(this.$refs.inputList){const e=this.MidiAccess.inputs.values();for(const t of e)t.onmidimessage=t.id===this.$refs.inputList.value?e=>this.$emit("midiInput",e):null;this.$emit("input",this.$refs.inputList.value)}this.loading=!1}}},O=D,U=(n("c773"),n("0c7c")),P=Object(U["a"])(O,B,F,!1,null,"6215e310",null),N=P.exports,G=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"loading",style:"background-image: url("+e.imgURL+")"})},L=[],W=n("1823"),J=n.n(W),V={name:"loading",data(){return{imgURL:J.a}}},Y=V,Z=(n("822d"),Object(U["a"])(Y,G,L,!1,null,"c59fbadc",null)),Q=Z.exports;const j={GroupLen:12,InnerRadius:30,ScrewPitch:4,KeyCount:88,NoteStart:21,NoteEnd:108,MiddleC:60,RegionRadius:400,Mode:{Major:{MainPitches:{0:!0,2:!0,4:!0,5:!0,7:!0,9:!0,11:!0},SyllableNames:["do",null,"re",null,"mi","fa",null,"so",null,"la",null,"ti"]},Minor:{MainPitches:{0:!0,2:!0,3:!0,5:!0,7:!0,8:!0,11:!0},SyllableNames:["do",null,"re","mi",null,"fa",null,"so","la",null,null,"ti"]}},KeySerials:{White:[0,2,4,5,7,9,11]},SpanKeyWidth:9},X=function(e){return j.NoteEnd-e},H=function(e){let t=e%j.GroupLen;return t<0&&(t+=j.GroupLen),t},z=function(e){return Math.floor(e/j.GroupLen)},_=function(e){let t=7*e%12;while(t<-5)t+=12;while(t>6)t-=12;return t},$=function(e,t){const n=[],r=(e+t)/2,a=(e-t)/2;for(let s=0;s<j.KeyCount+j.GroupLen+1;++s){const e=(X(s)-r)/a;n[s]=Math.exp(-e*e*e*e/2)}const i=n.reduce((e,t)=>e+t,0),o=12*(.9*j.RegionRadius-j.InnerRadius)/i;return n.map(e=>e*o)};var ee={name:"spiral-piano",directives:{resize:o.a},components:{MidiDevices:N,Loading:Q},data(){return{Config:j,size:null,extends:null,keyRadius:Array(j.KeyCount+j.GroupLen+1).fill().map((e,t)=>j.InnerRadius+t*j.ScrewPitch/j.GroupLen),keyPoints:null,modalOffset:0,keyWidthRatio:.5,mode:j.Mode.Major,wideRange:{Start:54,End:77},synesthesiaScheme:"FifthRainbow",keyStatus:Array(j.NoteEnd+1).fill().map(()=>({active:!1})),showDashboard:!1,drageHover:!1,isPlaying:!1,midiFileName:null,loading:!0}},computed:{fullWidth(){return this.size&&this.size.height>this.size.width},regions(){return Array(j.GroupLen).fill().map((e,t)=>{const n=Math.PI*(1.5+2*t/j.GroupLen),r=Math.PI*(1.5+2*(t+this.getOffsetAngles(t))/j.GroupLen);return{angle:n,boderAngle:r,point:{x:Math.cos(r)*j.RegionRadius,y:Math.sin(r)*j.RegionRadius},nextIndex:t>0?t-1:j.GroupLen-1,main:H(t+this.modalOffset)in this.mode.MainPitches}})},keys(){return this.keyPoints?Array(j.KeyCount).fill().map((e,t)=>{const n=X(t),r=z(n),[a,i,o,s]=[t,t+1,t+j.GroupLen+1,t+j.GroupLen];return{pitch:n,group:r,step:H(n),path:`M${this.keyPoints[a].x},${this.keyPoints[a].y}\n\t\t\t\t\t\tA${this.keyRadius[a]},${this.keyRadius[a]} 0 0 0 ${this.keyPoints[i].x},${this.keyPoints[i].y}\n\t\t\t\t\t\tL${this.keyPoints[o].x},${this.keyPoints[o].y}\n\t\t\t\t\t\tA${this.keyRadius[s]},${this.keyRadius[s]} 0 0 1 ${this.keyPoints[s].x},${this.keyPoints[s].y}\n\t\t\t\t\t\tZ`.replace(/\n/g,"")}}):null},groups(){return this.keys?Array(9).fill().map((e,t)=>({index:t+1,keys:this.keys.filter(e=>e.group===t+1)})):null},wideRangeHash(){return`${this.wideRange.Start}|${this.wideRange.End}`}},created(){document.querySelector("audio#audio")?this.loading=!1:K.loadPlugin().then(()=>{this.loading=!1,console.log("MIDI loaded.")})},mounted(){this.updateKeyRadius(),window.addEventListener("keydown",e=>{switch(e.keyCode){case 120:this.showDashboard=!this.showDashboard;break}}),K.Player.addListener(e=>{switch(e.message){case 144:this.activateKey(e.note,!0);break;case 128:this.activateKey(e.note,!1);break;case"meta":switch(e.subtype){case"keySignature":this.modalOffset=_(e.key);break}break}})},beforeDestroy(){K.stopAllNotes(),K.Player.pause()},methods:{onResize(){this.size={width:this.$el.clientWidth,height:this.$el.clientHeight}},async onDropFiles(e){this.drageHover=!1,K.Player.stop(),this.isPlaying=!1;const t=e.dataTransfer.files[0];switch(t.type){case"audio/mid":case"audio/midi":const e=await t.readAs("ArrayBuffer"),n=new Blob([e],{type:t.type}),r=URL.createObjectURL(n);await K.Player.loadFile(r),console.log("MIDI file loaded."),this.midiFileName=t.name,this.onPlayFile();break}},onPlayFile(){this.isPlaying?(K.Player.pause(),this.isPlaying=!1):(K.Player.resume(),this.isPlaying=!0)},updateKeyRadius(){this.extends=$(this.wideRange.Start,this.wideRange.End);for(let e=0;e<j.KeyCount+j.GroupLen+1;++e){let t=0;for(let n=Math.floor(e/j.GroupLen);n>0;--n)t+=this.extends[e-n*j.GroupLen];this.keyRadius[e]=j.InnerRadius+e*j.ScrewPitch/j.GroupLen+t}this.keyPoints=Array(j.KeyCount+j.GroupLen+1).fill().map((e,t)=>{const n=this.getOffsetAngles(X(t)-this.modalOffset),r=Math.PI*(1.5-2*(this.modalOffset+t-n)/j.GroupLen),a=(this.keyRadius[t]+(t>0?this.keyRadius[t-1]:this.keyRadius[t]))/2;return{x:Math.cos(r)*a,y:Math.sin(r)*a}})},getOffsetAngles(e){const t=[H(e+1)in this.mode.MainPitches,H(e)in this.mode.MainPitches];return t[0]===t[1]?.5:t[0]?1-this.keyWidthRatio:this.keyWidthRatio},activateKey(e,t){this.keyStatus[e].active=t},onKeyDown(e){this.activateKey(e,!0),K.noteOn(0,e,100,0)},onKeyUp(e){this.activateKey(e,!1),K.noteOff(0,e,0)},onMidiInputMessage(e){console.log("message:",e);const t=e.data[0]>>4,n=15&e.data[0],r=e.data[1],a=e.data[2];switch(t){case 9:if(a>0){this.activateKey(r,!0),K.noteOn(n,r,a,0);break}case 8:this.activateKey(r,!1),K.noteOff(n,r,0);break}}},watch:{wideRangeHash:"updateKeyRadius"}},te=ee,ne=(n("e9bf"),Object(U["a"])(te,r,a,!1,null,"64a73e2d",null));t["default"]=ne.exports},c773:function(e,t,n){"use strict";var r=n("fbee"),a=n.n(r);a.a},e9bf:function(e,t,n){"use strict";var r=n("7a47"),a=n.n(r);a.a},fbee:function(e,t,n){}}]);
//# sourceMappingURL=spiral-piano.f0210f00.js.map